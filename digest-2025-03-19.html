<html>

<head>
  <title>Digest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-weight: 400;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      font-size: 16px;
    }

    body {
      font-size: 1rem;
      padding: 1rem;
    }

    h1,
    h1 span {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    h2.summary {
      display: inline-block;
      cursor: pointer;
      color: slategray;
      font-size: 1.25rem;
    }

    details+details {
      margin-top: 0.5rem;
    }

    details ul {
      margin-bottom: 1rem;
      margin-top: 0.5rem;
    }


    ul {
      list-style-type: none;
      list-style-position: outside;
    }

    a.li {
      display: block;
    }

    ul li {
      padding: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease-in-out;
    }

    ul li:hover {
      background: aliceblue;
    }

    a.li+a.li {
      border-top: 1px solid aliceblue;
    }

    li .date {
      font-size: 0.65em;
      color: slategray;
    }

    ul li .domain {
      font-size: 14px;
      color: slategray;
    }

    @media (max-width:767px) {
      ul li .domain {
        display: none;
      }
    }

    a {
      color: cornflowerblue;
      text-decoration: none;
    }

    a:visited {
      color: lightblue !important;
    }

    a:visited * {
      opacity: 0.5;
    }

    p.summary {
      font-style: italic;
      margin: 0 0 2rem 0;
    }

    p.toggler {
      margin-bottom: 1rem;
      font-size: 0.7rem;
      cursor: pointer;
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: white;
      padding: 0.5rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    span.digest-date {
      color: slategray;
    }
  </style>
  <script>
    let toggleState = false;
    function toggle() {
      toggleState = !toggleState;
      setTimeout(() => {
        const details = document.querySelectorAll("details");
        details.forEach((detail) => {
          detail.open = toggleState;
        });
      }, 10)
    }
  </script>
</head>

<body>
  <h1>Digest — <span class="digest-date">2025-03-19</span>:</h1>
  <p class="summary">There are 265 posts.</p>
  <p class="toggler">
    <span onclick="toggle();">Expand/collapse all</span>
  </p>
  <article>
    <details open><summary><h2 class="summary">Aeon | a world of ideas (aeon.co)</h2> (1)</summary><ul><a class="li" href="https://aeon.co/videos/a-father-forgets-his-childs-name-for-the-first-time-in-this-poetic-reflection-on-memory?utm_source=rss-feed"><li><div class="title">By the time I reach him</div><div class="domain">aeon.co &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Bear Blog Trending Posts (bearblog.dev)</h2> (5)</summary><ul><a class="li" href="https://beew.me/enough-with-the-bullshit/"><li><div class="title">Enough With The Bullshit</div><div class="domain">beew.me &bull; March 19, 2025</div></li></a><a class="li" href="https://fusednix.com/transcend-jetflash-790c-apparently-a-usb-32-flash-drive-but-with-usb-2-speeds/"><li><div class="title">Transcend JetFlash 790C – Apparently a USB 3.2 flash drive, but with USB 2 speeds?</div><div class="domain">fusednix.com &bull; March 19, 2025</div></li></a><a class="li" href="https://prickly.oxhe.art/non-negotiable-self-care/"><li><div class="title">Non-Negotiable Self-Care: The Art of Being "Busy" for Yourself</div><div class="domain">prickly.oxhe.art &bull; March 19, 2025</div></li></a><a class="li" href="https://hwisnu.bearblog.dev/new-zig-014-compiler-features-fincremental-watch/"><li><div class="title">New Zig 0.14 compiler features -fincremental --watch</div><div class="domain">hwisnu.bearblog.dev &bull; March 19, 2025</div></li></a><a class="li" href="https://karpathy.bearblog.dev/the-append-and-review-note/"><li><div class="title">The append-and-review note</div><div class="domain">karpathy.bearblog.dev &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Big Think (bigthink.com)</h2> (4)</summary><ul><a class="li" href="https://bigthink.com/starts-with-a-bang/scientific-consensus-east-wrong/"><li><div class="title">Following the scientific consensus: How to be “the least wrong”</div><div class="domain">bigthink.com &bull; March 19, 2025</div></li></a><a class="li" href="https://bigthink.com/perception-box/atsuko-okatsuka/"><li><div class="title">Atsuko Okatsuka: Comedy, Chaos, and Finding a Place to Belong</div><div class="domain">bigthink.com &bull; March 19, 2025</div></li></a><a class="li" href="https://bigthink.com/mini-philosophy/finding-home-in-storyland-the-transformative-power-of-books/"><li><div class="title">Finding home in Storyland: The transformative power of books</div><div class="domain">bigthink.com &bull; March 19, 2025</div></li></a><a class="li" href="https://bigthink.com/the-future/what-is-the-great-progression-2025-to-2050/"><li><div class="title">What is The Great Progression: 2025 to 2050?</div><div class="domain">bigthink.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Cabinet Magazine (cabinetmagazine.org)</h2> (1)</summary><ul><a class="li" href="http://www.cabinetmagazine.org/events/diaz_hallett_paglen_reisman_after_spaceship_earth.php"><li><div class="title">&ldquo;Book Launch, Performance, and Screening / “After Spaceship Earth,” with Eva Díaz, Allora & Calzadilla, Nick Hallett, Trevor Paglen, and Sara Reisman&rdquo;</div><div class="domain">cabinetmagazine.org &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">The Marginalian (feeds.feedburner.com)</h2> (1)</summary><ul><a class="li" href="https://www.themarginalian.org/2025/03/18/berryman-advice/"><li><div class="title">How to Get Out of Your Own Way: John Berryman on Defeating the Three Demons of Creative Work</div><div class="domain">themarginalian.org &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">HBR.org (feeds.harvardbusiness.org)</h2> (4)</summary><ul><a class="li" href="https://hbr.org/sponsored/2025/03/protect-your-company-from-escalating-foreign-cyber-threats"><li><div class="title">Protect Your Company from Escalating Foreign Cyber Threats - SPONSOR CONTENT FROM THREATLOCKER</div><div class="domain">hbr.org &bull; March 19, 2025</div></li></a><a class="li" href="https://hbr.org/2025/03/the-managers-job-50-years-later"><li><div class="title">“The Manager’s Job,” 50 Years Later</div><div class="domain">hbr.org &bull; March 19, 2025</div></li></a><a class="li" href="https://hbr.org/podcast/2025/03/alphabet-ceo-on-ai-as-a-workplace-collaborator"><li><div class="title">Alphabet CEO on AI as a Workplace Collaborator</div><div class="domain">hbr.org &bull; March 19, 2025</div></li></a><a class="li" href="https://hbr.org/2025/03/strategic-impact-initiatives-can-make-your-business-stronger"><li><div class="title">Strategic Impact Initiatives Can Make Your Business Stronger</div><div class="domain">hbr.org &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">kottke.org (feeds.kottke.org)</h2> (8)</summary><ul><a class="li" href="https://kottke.org/25/03/0046462-editorial-from-nature-mag"><li><div class="title">Editorial from Nature magazine: Vaccines save lives. Leaders must champion them. &#8220;We...</div><div class="domain">kottke.org &bull; March 19, 2025</div></li></a><a class="li" href="https://kottke.org/25/03/0046463-trump-has-gone-from-uncon"><li><div class="title">Trump Has Gone From Unconstitutional to Anti-Constitutional. &#8220;[Anti-Constitutionalism] rejects the premise that...</div><div class="domain">kottke.org &bull; March 19, 2025</div></li></a><a class="li" href="https://kottke.org/25/03/0046466-a-un-world-meteorological"><li><div class="title">A UN World Meteorological Organization report &#8220;lists 151 unprecedented extreme weather events...</div><div class="domain">kottke.org &bull; March 19, 2025</div></li></a><a class="li" href="https://kottke.org/25/03/0046464-on-edward-goreys-great-si"><li><div class="title">On Edward Gorey&#8217;s Great Simple Theory About Art &#8220;Anything that is art&#8230;is...</div><div class="domain">kottke.org &bull; March 19, 2025</div></li></a><a class="li" href="https://kottke.org/25/03/0046468-we-might-get-to-see"><li><div class="title">We might get to see Coyote vs. Acme after all&#8230;Warner Bros. is...</div><div class="domain">kottke.org &bull; March 19, 2025</div></li></a><a class="li" href="https://kottke.org/25/03/0046467-thirty-lonely-but-beautif"><li><div class="title">&#8220;Thirty lonely but beautiful actions you can take right now which probably...</div><div class="domain">kottke.org &bull; March 19, 2025</div></li></a><a class="li" href="https://kottke.org/25/03/0046465-the-sticker-box-and-the"><li><div class="title">The Sticker Box and the Woodstock Message Tree. &#8220;What makes this sticker-covered...</div><div class="domain">kottke.org &bull; March 19, 2025</div></li></a><a class="li" href="https://kottke.org/25/03/a-history-professor-answers-questions-about-dictators"><li><div class="title">A History Professor Answers Questions About Dictators</div><div class="domain">kottke.org &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Go Make Things (gomakethings.com)</h2> (1)</summary><ul><a class="li" href="https://gomakethings.com/can-i-use-for-accessibility/"><li><div class="title">Can I Use for accessibility</div><div class="domain">gomakethings.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">LessWrong (lesswrong.com)</h2> (6)</summary><ul><a class="li" href="https://www.lesswrong.com/posts/KZrp5tJeLvoSbDryF/boots-theory-and-sybil-ramkin"><li><div class="title">Boots theory and Sybil Ramkin</div><div class="domain">lesswrong.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.lesswrong.com/posts/zqffB6gokoivwwn7X/elite-coordination-via-the-consensus-of-power"><li><div class="title">Elite Coordination via the Consensus of Power</div><div class="domain">lesswrong.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.lesswrong.com/posts/KL2BqiRv2MsZLihE3/going-nova"><li><div class="title">Going Nova</div><div class="domain">lesswrong.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.lesswrong.com/posts/rxcGvPrQsqoCHndwG/the-principle-of-genomic-liberty"><li><div class="title">The principle of genomic liberty</div><div class="domain">lesswrong.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.lesswrong.com/posts/deesrjitvXM4xYGZd/metr-measuring-ai-ability-to-complete-long-tasks"><li><div class="title">METR: Measuring AI Ability to Complete Long Tasks</div><div class="domain">lesswrong.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.lesswrong.com/posts/fCazYoZSSMadiT6sf/prioritizing-threats-for-ai-control"><li><div class="title">Prioritizing threats for AI control</div><div class="domain">lesswrong.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">lobste.rs (lobste.rs)</h2> (23)</summary><ul><a class="li" href="https://dobbse.net/thinair/2012/04/unsung-heros-sigsaly.html"><li><div class="title">Bell Labs' Unsung Heros in the History of Computing (2012)</div><div class="domain">dobbse.net &bull; March 19, 2025</div></li></a><a class="li" href="https://www.bartoszsypytkowski.com/conflict-free-database-over-virtual-file-system/"><li><div class="title">Conflict-free Database over Virtual File System</div><div class="domain">bartoszsypytkowski.com &bull; March 19, 2025</div></li></a><a class="li" href="https://canopylabs.ai/model-releases"><li><div class="title">Introducing Orpheus Speech</div><div class="domain">canopylabs.ai &bull; March 19, 2025</div></li></a><a class="li" href="https://refactoringenglish.com/chapters/passive-voice-considered-harmful/"><li><div class="title">Passive Voice Considered Harmful</div><div class="domain">refactoringenglish.com &bull; March 19, 2025</div></li></a><a class="li" href="https://devblogs.microsoft.com/oldnewthing/20250318-00/?p=110975"><li><div class="title">Why didn't Windows 95 setup use a miniature version of Windows 95 as its fallback GUI?</div><div class="domain">devblogs.microsoft.com &bull; March 19, 2025</div></li></a><a class="li" href="https://smallcultfollowing.com/babysteps/blog/2025/03/18/lang-interop-extensibility/"><li><div class="title">Language interop and the extensible compiler</div><div class="domain">smallcultfollowing.com &bull; March 19, 2025</div></li></a><a class="li" href="https://ezyang.github.io/ai-blindspots/"><li><div class="title">AI Blindspots</div><div class="domain">ezyang.github.io &bull; March 19, 2025</div></li></a><a class="li" href="https://mjg59.dreamwidth.org/71188.html"><li><div class="title">Failing upwards: the Twitter encrypted DM failure</div><div class="domain">mjg59.dreamwidth.org &bull; March 19, 2025</div></li></a><a class="li" href="https://developer.chrome.com/blog/memory-safety-fonts"><li><div class="title">Memory safety for web fonts</div><div class="domain">developer.chrome.com &bull; March 19, 2025</div></li></a><a class="li" href="https://xeno.graphics/"><li><div class="title">Weird but (sometimes) useful charts</div><div class="domain">xeno.graphics &bull; March 19, 2025</div></li></a><a class="li" href="https://fauna.com/blog/the-future-of-fauna"><li><div class="title">The Future of Fauna</div><div class="domain">fauna.com &bull; March 19, 2025</div></li></a><a class="li" href="https://michael.stapelberg.ch/posts/2025-03-19-intel-core-ultra-9-285k-on-asus-z890-not-stable/"><li><div class="title">Intel 9 285K on ASUS Z890: not stable</div><div class="domain">michael.stapelberg.ch &bull; March 19, 2025</div></li></a><a class="li" href="https://www.phoronix.com/news/Asahi-Lina-Steps-Down-Linux-GPU"><li><div class="title">Asahi Lina Pausing Work On Apple GPU Linux Driver Development</div><div class="domain">phoronix.com &bull; March 19, 2025</div></li></a><a class="li" href="https://lilysthings.org/blog/the-macos-blog-post/"><li><div class="title">The macOS Blog Post (ft. Hackintosh)</div><div class="domain">lilysthings.org &bull; March 19, 2025</div></li></a><a class="li" href="https://nnethercote.github.io/2025/03/19/how-to-speed-up-the-rust-compiler-in-march-2025.html"><li><div class="title">How to speed up the Rust compiler in March 2025</div><div class="domain">nnethercote.github.io &bull; March 19, 2025</div></li></a><a class="li" href="https://release.gnome.org/48/"><li><div class="title">GNOME 48 released</div><div class="domain">release.gnome.org &bull; March 19, 2025</div></li></a><a class="li" href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2025/p3651r0.pdf"><li><div class="title">Note to the C++ standards committee members on profiles and safety</div><div class="domain">open-std.org &bull; March 19, 2025</div></li></a><a class="li" href="https://git.sr.ht/~robheghan/glogg/tree/main/item/docs/motivation.md"><li><div class="title">In Search of the Next Great Programming Language</div><div class="domain">git.sr.ht &bull; March 19, 2025</div></li></a><a class="li" href="https://steveklabnik.com/writing/does-unsafe-undermine-rusts-guarantees/"><li><div class="title">Does unsafe undermine Rust's guarantees?</div><div class="domain">steveklabnik.com &bull; March 19, 2025</div></li></a><a class="li" href="https://mtlynch.io/no-longer-my-favorite-git-commit/"><li><div class="title">No Longer My Favorite Git Commit</div><div class="domain">mtlynch.io &bull; March 19, 2025</div></li></a><a class="li" href="https://www.gingerbill.org/article/2018/03/12/on-the-aesthetics-of-the-syntax-of-declarations/"><li><div class="title">On the Aesthetics of the Syntax of Declarations (2018)</div><div class="domain">gingerbill.org &bull; March 19, 2025</div></li></a><a class="li" href="https://franklantz.substack.com/p/why-i-love-set"><li><div class="title">Why I Love SET</div><div class="domain">franklantz.substack.com &bull; March 19, 2025</div></li></a><a class="li" href="https://greptime.com/blogs/2025-03-18-jsonbench-greptimedb-performance"><li><div class="title">GreptimeDB Leads in Cold Run Performance on ClickHouse’s billion JSON doc benchmark</div><div class="domain">greptime.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Longreads (longreads.com)</h2> (3)</summary><ul><a class="li" href="https://longreads.com/2025/03/19/the-doctor-the-biohacker-and-the-quest-to-treat-their-long-covid/"><li><div class="title">The Doctor, the Biohacker, and the Quest to Treat Their Long COVID</div><div class="domain">longreads.com &bull; March 19, 2025</div></li></a><a class="li" href="https://longreads.com/2025/03/19/how-to-think-about-the-sublime/"><li><div class="title">How to Think About the Sublime</div><div class="domain">longreads.com &bull; March 19, 2025</div></li></a><a class="li" href="https://longreads.com/2025/03/19/how-the-irish-pub-became-one-of-the-emerald-isles-greatest-exports/"><li><div class="title">How the Irish Pub Became One of the Emerald Isle’s Greatest Exports</div><div class="domain">longreads.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">matklad (matklad.github.io)</h2> (2)</summary><ul><a class="li" href="2025-03-19T00:00:00+00:002025-03-19T00:00:00+00:00https://matklad.github.io/2025/03/19/comptime-zig-ormAlex KladovThis post can be considered an advanced Zig tutorial. I will be covering some of the more unique
aspects of the language, but won't be explaining the easy part. If you haven't read the Zig
Language Reference, you might start there. Additionally,
we will also learn the foundational trick for implementing relational model.
<h1>Comptime Zig ORM <time class="meta" datetime="2025-03-19">Mar 19, 2025</time></h1>
<p>This post can be considered an advanced Zig tutorial. I will be covering some of the more unique
aspects of the language, but won’t be explaining the easy part. If you haven’t read the <a href="https://ziglang.org/documentation/0.14.0/">Zig
Language Reference</a>, you might start there. Additionally,
we will also learn the foundational trick for implementing relational model.</p>
<p>You <em>will</em> learn a sizable chunk of Zig after this post, but this isn’t going to be an easy read, so
prepare your favorite beverage and get comfy!</p>
<section id="On-Learning">

    <h2>
    <a href="#On-Learning">On Learning </a>
    </h2>
<p>One of the most ridiculously effective ways of learning for me is building <em>toy</em> versions of
programs. This is slightly more specific than “to learn to code, code”: I claim that you can learn
more by spending a week building your own very bad version of an application from scratch that you’d
learn from working full-time for a year on a production ready codebase. Case in point: although the
code in this post is lifted from <a href="https://github.com/tigerbeetle/tigerbeetle/">TigerBeetle</a>,
and I’ve been working with it for a couple of years, I’ve learned a bunch of new things myself
in the evening of hacking on the code for the post.</p>
<p>The hard part about the toy problem approach is finding the right toy! I remember, early in my
career, spending about a year pestering everything with “what is your favorite model problem?”
question, and not getting a real answer. Until one day <a href="https://github.com/zmactep">@zmacter</a> asked
“have you tried a raytracer?” and that became my model problem for learning programming languages.
Seriously, if you want to learn Zig, go write yourself a raytracer, I have some notes for that
<a href="https://matklad.github.io/2022/12/31/raytracer-construction-kit.html">here</a>.</p>
</section>
<section id="The-Database">

    <h2>
    <a href="#The-Database">The Database </a>
    </h2>
<p>In this post, we’ll work on a solution of a different model problem, which I think is an especially
good fit for showcasing Zig’s comptime capabilities. This problem is a simplified version of the
<a href="https://github.com/tigerbeetle/tigerbeetle/blob/0.16.32/src/lsm/forest.zig">LSM Forest</a> code from
TigerBeetle.</p>
<p>Specifically, we will be implementing an in-memory relational database, whose schema is set at
compile time. Before diving into the implementation, let’s sketch the interface we want.</p>
<p>First, we define objects which we will be storing in our database, accounts and transfers:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> Account = <span class="hl-keyword">struct</span> {</span>
<span class="line">    id: ID = <span class="hl-built_in">@enumFromInt</span>(<span class="hl-numbers">0</span>),</span>
<span class="line">    balance: <span class="hl-type">u128</span>,</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">const</span> ID = <span class="hl-keyword">enum</span>(<span class="hl-type">u64</span>) { _ };</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">const</span> Transfer = <span class="hl-keyword">struct</span> {</span>
<span class="line">    id: ID = <span class="hl-built_in">@enumFromInt</span>(<span class="hl-numbers">0</span>),</span>
<span class="line">    amount: <span class="hl-type">u128</span>,</span>
<span class="line">    debit_account: Account.ID,</span>
<span class="line">    credit_account: Account.ID,</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">const</span> ID = <span class="hl-keyword">enum</span>(<span class="hl-type">u64</span>) { _ };</span>
<span class="line">};</span></code></pre>

</figure>
<p>In Zig, <code>struct</code> is an expression that yields an anonymous struct type, which needs to be explicitly
bound to an identifier: <code class="display">const Account = struct { ... }</code></p>
<p>Structs contain fields and declarations. Fields can have default values. This curious pattern
<code class="display">pub const ID = enum(u64) { _ };</code>
is a Zig idiom for creating a newtype over an integer. <code>ID</code> is an enumeration, whose backing type is
<code>u64</code>. This enumeration doesn’t have any explicitly named variants, but it is open (<code>_</code>) — any
<code>u64</code> numeric value is considered to be a member. This is exactly what we want for an id — it’s an
opaque number with a unique type, whose “numberness” is not exposed (you can’t add two ids
together). In the transfer struct, we refer to account id:
<code class="display">debit_account: Account.ID</code></p>
<p>Note that although <code>Account.ID</code> and <code>Transfer.ID</code> have exactly the same definition, they are
distinct types. Let this sink in — Zig’s type system is nominal, but all types are anonymous!</p>
<p>Ids will be assigned by our database automatically, using an auto-incrementing counter, and we will
use zero id to signify a new object without an id assigned yet:
<code class="display">id: ID = @enumFromInt(0),</code></p>
<p><code>@enumFromInt</code> and <code>@intFromEnum</code> are built-in functions for casting between an enum and its backing
integer. It could have been cleaner to instead write:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> Account = <span class="hl-keyword">struct</span> {</span>
<span class="line">    id: ID = .unassigned,</span>
<span class="line">    balance: <span class="hl-type">u128</span>,</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">const</span> ID = <span class="hl-keyword">enum</span>(<span class="hl-type">u64</span>) {</span>
<span class="line">        unassigned = <span class="hl-numbers">0</span>,</span>
<span class="line">        _,</span>
<span class="line">    };</span>
<span class="line">};</span></code></pre>

</figure>
<p>That is, to add an explicitly named variant for zero.</p>

<aside class="admn note">
<svg class="icon"><use href="/assets/icons.svg#info"/></svg>
<div><p>A word on built in functions. In Zig, all compiler builtins use special syntax with <code>@</code>. This is
somewhat unusual — traditionally, builtins are some magic functions inside the standard library,
specially marked. Zig boldly uses a dedicated <em>syntax</em> for builtins, but, in the exchange, the Zig
standard library is not privileged at all. It is just a normal library which happens to be
distributed with the compiler, it doesn’t have special powers.</p>
</div>
</aside><hr>

<aside class="admn note">
<svg class="icon"><use href="/assets/icons.svg#info"/></svg>
<div><p>A word on type inference. Zig hits a sweet spot:</p>
<ul>
<li>
explicit types are rarely needed in expressions,
</li>
<li>
where they <em>are</em> needed a human reader usually wouldn’t be able to tell the type on the spot
anyway,
</li>
<li>
function signatures are always explicit,
</li>
<li>
and the inference algorithm is direct and simple.
</li>
</ul>
<p>Specifically, Zig doesn’t do Hindley-Milner (separate phases of constraint gathering and solving),
and instead directly infers a type of expression from the types of its subexpressions, with a small
twist. If the type of the result is known already through other means, it is propagated down.
Certain syntaxes and builtins take advantage of this known result type. Consider both flavors of
defaulting id to zero:</p>

<figure class="code-block">


<pre><code><span class="line">id: ID = .unassigned,</span>
<span class="line">id: ID = <span class="hl-built_in">@enumFromInt</span>(<span class="hl-numbers">0</span>),</span></code></pre>

</figure>
<p>Here, the result type is known, it is <code>ID</code>. So, when Zig evaluates <code>.unassigned</code>, it knows that the
result type must be <code>ID</code>, and “desugars” the shorthand to <code>ID.unassigned</code> (the type needn’t be
namable). Similarly, for <code>@enumFromInt</code> case, the type of an enum to convert to is taken from the
result. If the type is not otherwise known from the context, the result is a compilation error which
can be fixed with an <code>@as</code> type ascription builtin:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-comment">// Compilation error: _which_ enum?</span></span>
<span class="line"><span class="hl-keyword">const</span> mystery = <span class="hl-built_in">@enumFromInt</span>(<span class="hl-numbers">0</span>);</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">const</span> mystery = <span class="hl-built_in">@as</span>(ID, <span class="hl-built_in">@enumFromInt</span>(<span class="hl-numbers">0</span>));</span></code></pre>

</figure>
<p>Note how Zig doesn’t need type ascription <em>syntax</em>, and just uses a builtin function.</p>
</div>
</aside><p>So, yeah, we have accounts and transfers, they both have ids assigned by the database, an account
has a balance, a transfer has an amount and refers to two accounts:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> Account = <span class="hl-keyword">struct</span> {</span>
<span class="line">    id: ID = <span class="hl-built_in">@enumFromInt</span>(<span class="hl-numbers">0</span>),</span>
<span class="line">    balance: <span class="hl-type">u128</span>,</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">const</span> ID = <span class="hl-keyword">enum</span>(<span class="hl-type">u64</span>) { _ };</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">const</span> Transfer = <span class="hl-keyword">struct</span> {</span>
<span class="line">    id: ID = <span class="hl-built_in">@enumFromInt</span>(<span class="hl-numbers">0</span>),</span>
<span class="line">    amount: <span class="hl-type">u128</span>,</span>
<span class="line">    debit_account: Account.ID,</span>
<span class="line">    credit_account: Account.ID,</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">const</span> ID = <span class="hl-keyword">enum</span>(<span class="hl-type">u64</span>) { _ };</span>
<span class="line">};</span></code></pre>

</figure>
<p>Now, let’s define our database from the schema:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> DBType = <span class="hl-built_in">@import</span>(<span class="hl-string">&quot;./db.zig&quot;</span>).DBType;</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">const</span> DB = DBType(.{</span>
<span class="line">    .tables = .{</span>
<span class="line">        .account = Account,</span>
<span class="line">        .transfer = Transfer,</span>
<span class="line">    },</span>
<span class="line">    .indexes = .{</span>
<span class="line">        .transfer = .{</span>
<span class="line">            .debit_account, .credit_account,</span>
<span class="line">        },</span>
<span class="line">    },</span>
<span class="line">});</span></code></pre>

</figure>
<p>A lot is going on here. First, we use <code>@import</code> builtin function to import (look, no need for syntax
again!) the <code>DBType</code> function. <code>DBType</code> is a type constructor — it takes a DB schema, and returns a
database type. For the schema, we ask for two tables, accounts and transfers, and also ask to
include indexes on transfers’ foreign keys.</p>
<p>The implementation of <code>DBType</code> is the meat of this post, but, for now, let’s see how we use it.
Let’s write a function to add a transfer to the database:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> create_transfer</span>(</span>
<span class="line">    db: <span class="hl-operator">*</span>DB,</span>
<span class="line">    gpa: std.mem.Allocator,</span>
<span class="line">    debit_account: Account.ID,</span>
<span class="line">    credit_account: Account.ID,</span>
<span class="line">    amount: <span class="hl-type">u128</span>,</span>
<span class="line">) <span class="hl-operator">!</span>?Transfer.ID {</span>
<span class="line">    ...</span>
<span class="line">}</span></code></pre>

</figure>
<p>Zig doesn’t have a global allocator, so anything that needs to allocate takes an allocator argument.
<code>std.mem.Allocator</code> is dynamically dispatched: inside it are a type-erased pointer to a particular
allocator’s state, and a pointer to a vtable:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> Allocator = <span class="hl-keyword">struct</span> {</span>
<span class="line">    ptr: <span class="hl-operator">*</span>anyopaque,</span>
<span class="line">    vtable: <span class="hl-operator">*</span><span class="hl-keyword">const</span> VTable,</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">const</span> VTable = <span class="hl-keyword">struct</span> {</span>
<span class="line">        alloc: <span class="hl-operator">*</span><span class="hl-keyword">const</span> <span class="hl-keyword">fn</span><span class="hl-function"> (</span></span>
<span class="line"><span class="hl-function">            *anyopaque</span>,</span>
<span class="line">            len: <span class="hl-type">usize</span>,</span>
<span class="line">            alignment: Alignment,</span>
<span class="line">            ret_addr: <span class="hl-type">usize</span>,</span>
<span class="line">        ) ?[<span class="hl-operator">*</span>]<span class="hl-type">u8</span>,</span>
<span class="line">        ...</span>
<span class="line">    };</span>
<span class="line">};</span></code></pre>

</figure>
<p>This is a trait object, coded manually. <code>gpa</code> stands for general purpose allocator, which behaves
more or less like a global allocator would, as far as the code is concerned. You often see <code>arena:
Allocator</code>, signifying that memory doesn’t need to be freed on per-object basis, or <code>scratch:
Allocator</code>, signifying that the memory can be used for short-lived allocations inside the function,
but can’t outlive it.</p>
<p>Inserting a new object into our in-memory database could allocate, so we need an allocator argument,
and, conversely, need to signal possibility of an allocation failure in our result type, which is
what the bang (<code>!</code>) is for.</p>
<p>Another reason for why the operation might fail is that the transfer itself might be invalid (e.g.,
insufficient balance). For simplicity, I choose to model this by returning a <code>null</code> instead of
<code>Transfer.ID</code>, hence the question mark (<code>?</code>).</p>

<aside class="admn note">
<svg class="icon"><use href="/assets/icons.svg#info"/></svg>
<div><p>In Zig, types are always specified in prefix notation, without exception. For example,
<code class="display">[3]?struct { r: u8, g: u8, b:u8 }</code>
is an array of three optional colors.</p>
</div>
</aside><p>Let’s see the implementation of <code>create_transfer</code>:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">if</span> (debit_account <span class="hl-operator">==</span> credit_account) <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line"><span class="hl-keyword">const</span> dr = db.account.get(debit_account) <span class="hl-keyword">orelse</span></span>
<span class="line">    <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line"><span class="hl-keyword">const</span> cr = db.account.get(credit_account) <span class="hl-keyword">orelse</span></span>
<span class="line">    <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line"><span class="hl-keyword">if</span> (dr.balance &lt; amount) <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line"><span class="hl-keyword">if</span> (cr.balance &gt; std.math.maxInt(<span class="hl-type">u128</span>) <span class="hl-operator">-</span> amount) <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line"></span>
<span class="line">db.account.update(.{</span>
<span class="line">    .id = debit_account,</span>
<span class="line">    .balance = dr.balance <span class="hl-operator">-</span> amount,</span>
<span class="line">});</span>
<span class="line">db.account.update(.{</span>
<span class="line">    .id = credit_account,</span>
<span class="line">    .balance = dr.balance <span class="hl-operator">+</span> amount,</span>
<span class="line">});</span>
<span class="line"><span class="hl-keyword">return</span> <span class="hl-keyword">try</span> db.transfer.create(gpa, .{</span>
<span class="line">    .debit_account = debit_account,</span>
<span class="line">    .credit_account = credit_account,</span>
<span class="line">    .amount = amount,</span>
<span class="line">});</span></code></pre>

</figure>
<p>Zig doesn’t require braces around if’s body which makes for concise “guard” ifs. It comes with
autoformatter out of the box, so there’s very little possibility for indentation confusion.</p>
<p><code>db.account.get(credit_account)</code> looks up an account by an id. The account might or might not exist,
the return type of this function is <code>?Account</code>. Zig’s <code>orelse</code> unpacks optionals. The type of
<code>return</code> expression is <code>noreturn</code> (<code>!</code> from Rust), so the type of <code>cr</code> and <code>dr</code> is just <code>Account</code>,
without a question mark. Instead of <code>return</code>ing, we could have <code>orelse</code>ed some default <code>Account</code>.</p>
<p>This line is the only place where we need to help type inference by spelling a type explicitly:
<code class="display">if (cr.balance &gt; std.math.maxInt(u128) - amount) return null;</code></p>
<p>We pass the <code>u128</code> type to the <code>maxInt</code> function. This is the case where a sophisticated smart type
inference algorithm could look at the surrounding context and <em>infer</em> the type, but Zig deliberately
requires the user to spell it in situations like this.</p>
<p>Having done the balance checks, we ask our database to update the two balances, and to persist the
new transfer object. Only <code>transfer.create</code> calls gets an allocator, so it is immediately obvious
that only this part of the function can allocate.</p>
</section>
<section id="A-Usage-Example">

    <h2>
    <a href="#A-Usage-Example">A Usage Example </a>
    </h2>
<p>Now, let’s write some test program:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> main</span>() <span class="hl-operator">!</span><span class="hl-type">void</span> {</span>
<span class="line">    ...</span>
<span class="line">}</span></code></pre>

</figure>
<p>We are going to allocate, so we might fail, so we return <code>!void</code>. So, we’ll need an allocator:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">var</span> gpa_instance: std.heap.DebugAllocator(.{}) = .{};</span>
<span class="line"><span class="hl-keyword">const</span> gpa = gpa_instance.allocator();</span></code></pre>

</figure>
<p><code>gpa_instance</code> is a concrete allocator, of type <code>std.heap.DebugAllocator(.{})</code>. It is initialized
with default values for all the fields. When evaluating <code>= .{}</code>, Zig knows the result type, so it
knows <em>which</em> fields are defaulted.</p>
<p><code>gpa</code> is our trait object. Internally, it contains a pointer to <code>gpa_instance</code>. The state of
<code>gpa_instance</code> will be mutated, so it needs to be declared as a <code>var</code>. The <code>gpa</code> though is just a
pair of pointers, and those pointers won’t be mutated themselves, so we can declare it <code>const</code>,
similarly to how in Rust you’d write</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">let</span> <span class="hl-keyword">mut </span><span class="hl-variable">x</span> = <span class="hl-number">92</span>;</span>
<span class="line"><span class="hl-keyword">let</span> <span class="hl-variable">r</span> = &amp;<span class="hl-keyword">mut</span> x; <span class="hl-comment">// no mut on r!</span></span></code></pre>

</figure>
<p>Because Zig doesn’t track aliasing in the type system, figuring out what can get mutated when is
generally harder in Zig than in Rust.</p>
<p>For the usage example, we’ll need some random numbers, which follow a similar pattern — a
concrete PRNG and a dynamically dispatched trait object / vtable:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">var</span> random_instance = std.Random.DefaultPrng.init(<span class="hl-numbers">92</span>);</span>
<span class="line"><span class="hl-keyword">const</span> random = random_instance.random();</span></code></pre>

</figure>
<p>Finally, we create an instance of our database:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">var</span> db: DB = .{};</span>
<span class="line"><span class="hl-comment">// defer db.deinit(gpa);</span></span></code></pre>

</figure>
<p><code>DB</code> will allocate memory, so we absolutely do need a deinit function to free it, but I am excluding
it from the tutorial, as it requires some not particularly illuminating legwork.</p>
<p>For starters, just create two accounts and a transfer:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> alice: Account.ID =</span>
<span class="line">    <span class="hl-keyword">try</span> db.account.create(gpa, .{ .balance = <span class="hl-numbers">100</span> });</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">const</span> bob: Account.ID =</span>
<span class="line">    <span class="hl-keyword">try</span> db.account.create(gpa, .{ .balance = <span class="hl-numbers">200</span> });</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">const</span> transfer: ?Transfer.ID =</span>
<span class="line">    <span class="hl-keyword">try</span> create_transfer(<span class="hl-operator">&amp;</span>db, gpa, alice, bob, <span class="hl-numbers">100</span>);</span>
<span class="line"></span>
<span class="line">assert(transfer <span class="hl-operator">!=</span> <span class="hl-literal">null</span>);</span></code></pre>

</figure>
<p>So far, this feels like a hash-map with more steps. We aren’t doing anything relational here. We
will, soon, but we’ll need some fake data. To keep things a touch more realistic, we won’t be
distributing transfers equally between accounts, and instead ensure that 20% of hottest accounts are
responsible for 80% of transfers:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> pareto_index</span>(random: std.Random, count: <span class="hl-type">usize</span>) <span class="hl-type">usize</span> {</span>
<span class="line">    assert(count &gt; <span class="hl-numbers">0</span>);</span>
<span class="line">    <span class="hl-keyword">const</span> hot = <span class="hl-built_in">@divFloor</span>(count <span class="hl-operator">*</span> <span class="hl-numbers">2</span>, <span class="hl-numbers">10</span>);</span>
<span class="line">    <span class="hl-keyword">if</span> (hot <span class="hl-operator">==</span> <span class="hl-numbers">0</span>) <span class="hl-keyword">return</span> random.uintLessThan(<span class="hl-type">usize</span>, count);</span>
<span class="line">    <span class="hl-keyword">if</span> (random.uintLessThan(<span class="hl-type">u32</span>, <span class="hl-numbers">10</span>) &lt; <span class="hl-numbers">8</span>) {</span>
<span class="line">        <span class="hl-keyword">return</span> pareto_index(random, hot);</span>
<span class="line">    }</span>
<span class="line">    <span class="hl-keyword">return</span> hot <span class="hl-operator">+</span> random.uintLessThan(<span class="hl-type">usize</span>, count <span class="hl-operator">-</span> hot);</span>
<span class="line">}</span></code></pre>

</figure>
<p>Nothing new here — <code>@divFloor</code> is another builtin (an intention-bearing name for <code>/</code>), and we need
to pass the type we want to get out of random explicitly, instead of having type inference (and the
human reader) figuring it out.</p>
<p>The loop to populate the database is slightly more interesting:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">var</span> accounts: std.ArrayListUnmanaged(Account.ID) = .empty;</span>
<span class="line"><span class="hl-keyword">defer</span> accounts.deinit(gpa);</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">const</span> account_count = <span class="hl-numbers">100</span>;</span>
<span class="line"><span class="hl-keyword">try</span> accounts.ensureTotalCapacity(gpa, account_count);</span>
<span class="line"></span>
<span class="line">accounts.appendAssumeCapacity(alice);</span>
<span class="line">accounts.appendAssumeCapacity(bob);</span>
<span class="line"><span class="hl-keyword">while</span> (accounts.items.len &lt; account_count) {</span>
<span class="line">    <span class="hl-keyword">const</span> account = <span class="hl-keyword">try</span> db.account.create(gpa, .{ .balance = <span class="hl-numbers">1000</span> });</span>
<span class="line">    accounts.appendAssumeCapacity(account);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">const</span> transfer_count = <span class="hl-numbers">100</span>;</span>
<span class="line"><span class="hl-keyword">for</span> (<span class="hl-numbers">0</span>..transfer_count) <span class="hl-operator">|</span>_<span class="hl-operator">|</span> {</span>
<span class="line">    <span class="hl-keyword">const</span> debit = pareto_index(random, account_count);</span>
<span class="line">    <span class="hl-keyword">const</span> credit = pareto_index(random, account_count);</span>
<span class="line">    <span class="hl-keyword">const</span> amount = random.uintLessThan(<span class="hl-type">u128</span>, <span class="hl-numbers">10</span>);</span>
<span class="line">    _ = <span class="hl-keyword">try</span> create_transfer(</span>
<span class="line">        <span class="hl-operator">&amp;</span>db,</span>
<span class="line">        gpa,</span>
<span class="line">        accounts.items[debit],</span>
<span class="line">        accounts.items[credit],</span>
<span class="line">        amount,</span>
<span class="line">    );</span>
<span class="line">}</span></code></pre>

</figure>
<p>We’ll need to store generated account ids somewhere, so we use an <code>ArrayList</code>. Zig <em>strongly</em> pushes
you towards batching your allocations, so we preallocate space for a hundred accounts at once, and
then append <em>without</em> passing a <code>gpa</code> in. For  simplicity, we don’t implement reservation API for
our database, so we do need a <code>gpa</code> when creating an account or a transfer.</p>
<p>In Zig, unused return value is a compilation error, so we need <code>_ =</code> to ignore the result of the
transfer.</p>
<p>Finally, we come to the relational part of the tutorial, we’ll do a non-trivial lookup. First, we’ll
ask for all transfers from <code>alice</code> to anyone, and then for transfers between <code>alice</code> and <code>bob</code>
specifically:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">var</span> transfers_buffer: [<span class="hl-numbers">10</span>]Transfer = <span class="hl-literal">undefined</span>;</span>
<span class="line hl-line"><span class="hl-keyword">const</span> alice_transfers = db.transfer.filter(</span>
<span class="line hl-line">    .{ .debit_account = alice },</span>
<span class="line hl-line">    <span class="hl-operator">&amp;</span>transfers_buffer,</span>
<span class="line hl-line">);</span>
<span class="line"><span class="hl-keyword">for</span> (alice_transfers) <span class="hl-operator">|</span>t<span class="hl-operator">|</span> {</span>
<span class="line">    std.debug.print(<span class="hl-string">&quot;alice: from={} to={} amount={}<span class="hl-string">\n</span>&quot;</span>, .{</span>
<span class="line">        t.debit_account,</span>
<span class="line">        t.credit_account,</span>
<span class="line">        t.amount,</span>
<span class="line">    });</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line hl-line"><span class="hl-keyword">const</span> alice_to_bob_transfers = db.transfer.filter(</span>
<span class="line hl-line">    .{ .debit_account = alice, .credit_account = bob },</span>
<span class="line hl-line">    <span class="hl-operator">&amp;</span>transfers_buffer,</span>
<span class="line hl-line">);</span>
<span class="line"><span class="hl-keyword">for</span> (alice_to_bob_transfers) <span class="hl-operator">|</span>t<span class="hl-operator">|</span> {</span>
<span class="line">    std.debug.print(<span class="hl-string">&quot;alice to bob: from={} to={} amount={}<span class="hl-string">\n</span>&quot;</span>, .{</span>
<span class="line">        t.debit_account,</span>
<span class="line">        t.credit_account,</span>
<span class="line">        t.amount,</span>
<span class="line">    });</span>
<span class="line">}</span></code></pre>

</figure>
<p>The interesting parts are highlighted. We can ask the database to filter transfer objects to only
those with matching attributes. You can do it using a brute-force loop over all transfers. But, if
you are serious about your relational model, you obviously want to be faster than that! I wonder if
this has something to do with the indexes we added when declaring <code>DB</code>?</p>
<p>For Zig specifics, I don’t want to allocate the result, and I don’t want to bother with iterators,
so I pass a stack-allocated out buffer in.</p>
</section>
<section id="A-Call-To-Action">

    <h2>
    <a href="#A-Call-To-Action">A Call To Action </a>
    </h2>
<p>Here’s what we got so far, the interface for the so-far mysterious <code>db.zig</code>:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> std = <span class="hl-built_in">@import</span>(<span class="hl-string">&quot;std&quot;</span>);</span>
<span class="line"><span class="hl-keyword">const</span> assert = std.debug.assert;</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">const</span> DBType = <span class="hl-built_in">@import</span>(<span class="hl-string">&quot;./db.zig&quot;</span>).DBType;</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">const</span> Account = <span class="hl-keyword">struct</span> {</span>
<span class="line">    id: ID = <span class="hl-built_in">@enumFromInt</span>(<span class="hl-numbers">0</span>),</span>
<span class="line">    balance: <span class="hl-type">u128</span>,</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">const</span> ID = <span class="hl-keyword">enum</span>(<span class="hl-type">u64</span>) {</span>
<span class="line">        unassigned,</span>
<span class="line">        _,</span>
<span class="line">    };</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">const</span> Transfer = <span class="hl-keyword">struct</span> {</span>
<span class="line">    id: ID = <span class="hl-built_in">@enumFromInt</span>(<span class="hl-numbers">0</span>),</span>
<span class="line">    amount: <span class="hl-type">u128</span>,</span>
<span class="line">    debit_account: Account.ID,</span>
<span class="line">    credit_account: Account.ID,</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">const</span> ID = <span class="hl-keyword">enum</span>(<span class="hl-type">u64</span>) { _ };</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">const</span> DB = DBType(.{</span>
<span class="line">    .tables = .{</span>
<span class="line">        .account = Account,</span>
<span class="line">        .transfer = Transfer,</span>
<span class="line">    },</span>
<span class="line">    .indexes = .{</span>
<span class="line">        .transfer = .{</span>
<span class="line">            .debit_account, .credit_account,</span>
<span class="line">        },</span>
<span class="line">    },</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> create_transfer</span>(</span>
<span class="line">    db: <span class="hl-operator">*</span>DB,</span>
<span class="line">    gpa: std.mem.Allocator,</span>
<span class="line">    debit_account: Account.ID,</span>
<span class="line">    credit_account: Account.ID,</span>
<span class="line">    amount: <span class="hl-type">u128</span>,</span>
<span class="line">) <span class="hl-operator">!</span>?Transfer.ID {</span>
<span class="line">    <span class="hl-keyword">if</span> (debit_account <span class="hl-operator">==</span> credit_account)</span>
<span class="line">        <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line">    <span class="hl-keyword">const</span> dr = db.account.get(debit_account) <span class="hl-keyword">orelse</span></span>
<span class="line">        <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line">    <span class="hl-keyword">const</span> cr = db.account.get(credit_account) <span class="hl-keyword">orelse</span></span>
<span class="line">        <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line">    <span class="hl-keyword">if</span> (dr.balance &lt; amount) <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line">    <span class="hl-keyword">if</span> (cr.balance &gt; std.math.maxInt(<span class="hl-type">u128</span>) <span class="hl-operator">-</span> amount) <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line"></span>
<span class="line">    db.account.update(.{</span>
<span class="line">        .id = debit_account,</span>
<span class="line">        .balance = dr.balance <span class="hl-operator">-</span> amount,</span>
<span class="line">     });</span>
<span class="line">    db.account.update(.{</span>
<span class="line">        .id = credit_account,</span>
<span class="line">        .balance = dr.balance <span class="hl-operator">+</span> amount,</span>
<span class="line">     });</span>
<span class="line">    <span class="hl-keyword">return</span> <span class="hl-keyword">try</span> db.transfer.create(gpa, .{</span>
<span class="line">        .debit_account = debit_account,</span>
<span class="line">        .credit_account = credit_account,</span>
<span class="line">        .amount = amount,</span>
<span class="line">    });</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> main</span>() <span class="hl-operator">!</span><span class="hl-type">void</span> {</span>
<span class="line">    <span class="hl-keyword">var</span> gpa_instance: std.heap.DebugAllocator(.{}) = .{};</span>
<span class="line">    <span class="hl-keyword">const</span> gpa = gpa_instance.allocator();</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">var</span> random_instance = std.Random.DefaultPrng.init(<span class="hl-numbers">92</span>);</span>
<span class="line">    <span class="hl-keyword">const</span> random = random_instance.random();</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">var</span> db: DB = .{};</span>
<span class="line">    <span class="hl-comment">// defer db.deinit(gpa);</span></span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">const</span> alice: Account.ID =</span>
<span class="line">        <span class="hl-keyword">try</span> db.account.create(gpa, .{ .balance = <span class="hl-numbers">100</span> });</span>
<span class="line">    <span class="hl-keyword">const</span> bob: Account.ID =</span>
<span class="line">        <span class="hl-keyword">try</span> db.account.create(gpa, .{ .balance = <span class="hl-numbers">200</span> });</span>
<span class="line">    <span class="hl-keyword">const</span> transfer =</span>
<span class="line">         <span class="hl-keyword">try</span> create_transfer(<span class="hl-operator">&amp;</span>db, gpa, alice, bob, <span class="hl-numbers">100</span>);</span>
<span class="line">    assert(transfer <span class="hl-operator">!=</span> <span class="hl-literal">null</span>);</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">var</span> accounts: std.ArrayListUnmanaged(Account.ID) = .empty;</span>
<span class="line">    <span class="hl-keyword">defer</span> accounts.deinit(gpa);</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">const</span> account_count = <span class="hl-numbers">100</span>;</span>
<span class="line">    <span class="hl-keyword">try</span> accounts.ensureTotalCapacity(gpa, account_count);</span>
<span class="line"></span>
<span class="line">    accounts.appendAssumeCapacity(alice);</span>
<span class="line">    accounts.appendAssumeCapacity(bob);</span>
<span class="line">    <span class="hl-keyword">while</span> (accounts.items.len &lt; account_count) {</span>
<span class="line">        <span class="hl-keyword">const</span> account =</span>
<span class="line">            <span class="hl-keyword">try</span> db.account.create(gpa, .{ .balance = <span class="hl-numbers">1000</span> });</span>
<span class="line">        accounts.appendAssumeCapacity(account);</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">const</span> transfer_count = <span class="hl-numbers">100</span>;</span>
<span class="line">    <span class="hl-keyword">for</span> (<span class="hl-numbers">0</span>..transfer_count) <span class="hl-operator">|</span>_<span class="hl-operator">|</span> {</span>
<span class="line">        <span class="hl-keyword">const</span> debit = pareto_index(random, account_count);</span>
<span class="line">        <span class="hl-keyword">const</span> credit = pareto_index(random, account_count);</span>
<span class="line">        <span class="hl-keyword">const</span> amount = random.uintLessThan(<span class="hl-type">u128</span>, <span class="hl-numbers">10</span>);</span>
<span class="line">        _ = <span class="hl-keyword">try</span> create_transfer(</span>
<span class="line">            <span class="hl-operator">&amp;</span>db,</span>
<span class="line">            gpa,</span>
<span class="line">            accounts.items[debit],</span>
<span class="line">            accounts.items[credit],</span>
<span class="line">            amount,</span>
<span class="line">        );</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">var</span> transfers_buffer: [<span class="hl-numbers">10</span>]Transfer = <span class="hl-literal">undefined</span>;</span>
<span class="line">    <span class="hl-keyword">const</span> alice_transfers = db.transfer.filter(</span>
<span class="line">        .{ .debit_account = alice },</span>
<span class="line">        <span class="hl-operator">&amp;</span>transfers_buffer</span>
<span class="line">    );</span>
<span class="line">    <span class="hl-keyword">for</span> (alice_transfers) <span class="hl-operator">|</span>t<span class="hl-operator">|</span> {</span>
<span class="line">        std.debug.print(<span class="hl-string">&quot;alice: from={} to={} amount={}<span class="hl-string">\n</span>&quot;</span>, .{</span>
<span class="line">            t.debit_account,</span>
<span class="line">            t.credit_account,</span>
<span class="line">            t.amount,</span>
<span class="line">        });</span>
<span class="line">    }</span>
<span class="line">    std.debug.print(<span class="hl-string">&quot;<span class="hl-string">\n</span><span class="hl-string">\n</span>&quot;</span>, .{});</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">const</span> alice_to_bob_transfers = db.transfer.filter(</span>
<span class="line">        .{ .debit_account = alice, .credit_account = bob },</span>
<span class="line">        <span class="hl-operator">&amp;</span>transfers_buffer,</span>
<span class="line">    );</span>
<span class="line">    <span class="hl-keyword">for</span> (alice_to_bob_transfers) <span class="hl-operator">|</span>t<span class="hl-operator">|</span> {</span>
<span class="line">        std.debug.print(<span class="hl-string">&quot;alice to bob: from={} to={} amount={}<span class="hl-string">\n</span>&quot;</span>, .{</span>
<span class="line">            t.debit_account,</span>
<span class="line">            t.credit_account,</span>
<span class="line">            t.amount,</span>
<span class="line">        });</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> pareto_index</span>(random: std.Random, count: <span class="hl-type">usize</span>) <span class="hl-type">usize</span> {</span>
<span class="line">    assert(count &gt; <span class="hl-numbers">0</span>);</span>
<span class="line">    <span class="hl-keyword">const</span> hot = <span class="hl-built_in">@divFloor</span>(count <span class="hl-operator">*</span> <span class="hl-numbers">2</span>, <span class="hl-numbers">10</span>);</span>
<span class="line">    <span class="hl-keyword">if</span> (hot <span class="hl-operator">==</span> <span class="hl-numbers">0</span>) <span class="hl-keyword">return</span> random.uintLessThan(<span class="hl-type">usize</span>, count);</span>
<span class="line">    <span class="hl-keyword">if</span> (random.uintLessThan(<span class="hl-type">u32</span>, <span class="hl-numbers">10</span>) &lt; <span class="hl-numbers">8</span>) <span class="hl-keyword">return</span> pareto_index(random, hot);</span>
<span class="line">    <span class="hl-keyword">return</span> hot <span class="hl-operator">+</span> random.uintLessThan(<span class="hl-type">usize</span>, count <span class="hl-operator">-</span> hot);</span>
<span class="line">}</span></code></pre>

</figure>
<p>If you want to get 90% out of this post, I <em>strongly</em> recommend you to not read any further, and
instead copy the above code into your own <code>main.zig</code> and try to write <code>db.zig</code> yourself. I do think
this is the most excellent exercise that can teach you more effectively than any blog post. It’ll
take <em>more</em> time, of course, but you’ll get more knowledge per minute spent out of it.</p>
<p>If you will settle for the 10%, read on! And, if you want 100% percent, then do your implementation
first and then come back here!</p>
</section>
<section id="The-Table">

    <h2>
    <a href="#The-Table">The Table </a>
    </h2>
<p>We will be building <code>db.zig</code> from the gound up. It all will make sense! At the end.</p>
<p>Our fundamental data structure is a sorted list of values. Here, I kindly ask the reader to engage
suspension of disbelief: in a real database we will be using a data structure with efficient lookups
and modifications, such as a B-tree or an LSM tree. For the purposes of this tutorial, we will use a
simple sorted array, and will just close our eyes on O(N) insertions and removals.</p>
<p>Values are going to be sorted by a particular field. For example, we sort transfers by their ids. So,
when creating a “Table” of transfers, we’ll need to pass the type of key, the type of value, and
functions for extracting and comparing keys:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> TransfersTable = TableType(Transfer.ID, Transfer, <span class="hl-keyword">struct</span> {</span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_fn</span>(value: Transfer) Transfer.ID {</span>
<span class="line">        <span class="hl-keyword">return</span> value.id;</span>
<span class="line">    }</span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_cmp</span>(lhs: Transfer.ID, rhs: Transfer.ID) std.math.Order {</span>
<span class="line">        <span class="hl-keyword">return</span> std.math.order(<span class="hl-built_in">@intFromEnum</span>(lhs), <span class="hl-built_in">@intFromEnum</span>(rhs));</span>
<span class="line">    }</span>
<span class="line">});</span></code></pre>

</figure>
<p>Here’s the corresponding declaration:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> TableType</span>(</span>
<span class="line">    <span class="hl-keyword">comptime</span> KeyType: <span class="hl-type">type</span>,</span>
<span class="line">    <span class="hl-keyword">comptime</span> ValueType: <span class="hl-type">type</span>,</span>
<span class="line">    <span class="hl-keyword">comptime</span> Functions: <span class="hl-type">type</span>,</span>
<span class="line">) <span class="hl-type">type</span> {</span>
<span class="line">    <span class="hl-keyword">const</span> key_fn = Functions.key_fn;</span>
<span class="line">    <span class="hl-keyword">const</span> key_cmp = Functions.key_cmp;</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">return</span> <span class="hl-keyword">struct</span> {</span>
<span class="line">        ...</span>
<span class="line">    };</span>
<span class="line">}</span></code></pre>

</figure>
<p>This is a type constructor function, which takes a bunch of types as arguments and returns a new
type. Such functions can only be called at compile time., Zig doesn’t have the ability to create new
types at runtime, unlike something like the JVM.</p>
<p>Passing the table of functions as a <code>Functions</code> type is a weird idiom of Zig. It would be more
natural to use the following signature:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> TableType</span>(</span>
<span class="line">    <span class="hl-keyword">comptime</span> KeyType: <span class="hl-type">type</span>,</span>
<span class="line">    <span class="hl-keyword">comptime</span> ValueType: <span class="hl-type">type</span>,</span>
<span class="line">    <span class="hl-keyword">comptime</span> key_fn: <span class="hl-keyword">fn</span><span class="hl-function">(value</span>: ValueType): KeyType,</span>
<span class="line">    <span class="hl-keyword">comptime</span> key_cmp: <span class="hl-keyword">fn</span><span class="hl-function">(lhs</span>: KeyType, rhs: KeyType): std.math.Order,</span>
<span class="line">) <span class="hl-type">type</span></span></code></pre>

</figure>
<p>But this version is more painful to use at the call site. While <code>struct</code> is an expression in <code>Zig</code>,
and you can declare one inline, <code>fn</code> is not an expression, you can’t declare a function inline unless
you employ another Zig idiom:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> my_function = <span class="hl-keyword">struct</span> {</span>
<span class="line">    <span class="hl-keyword">fn</span><span class="hl-function"> double</span>(x: <span class="hl-type">u32</span>) <span class="hl-type">u32</span> { <span class="hl-keyword">return</span> x <span class="hl-operator">*</span> <span class="hl-numbers">2</span>; }</span>
<span class="line">}.double;</span></code></pre>

</figure>
<p>Here’s the implementation of the table:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">struct</span> {</span>
<span class="line">    values: std.ArrayListUnmanaged(Value) = .empty,</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">const</span> Key = KeyType;</span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">const</span> Value = ValueType;</span>
<span class="line">    <span class="hl-keyword">const</span> Table = <span class="hl-built_in">@This</span>();</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> search</span>(</span>
<span class="line">        table: <span class="hl-operator">*</span><span class="hl-keyword">const</span> Table,</span>
<span class="line">        key: Key,</span>
<span class="line">        start_index: <span class="hl-type">usize</span>,</span>
<span class="line">    ) <span class="hl-type">usize</span> {</span>
<span class="line">        <span class="hl-keyword">return</span> start_index <span class="hl-operator">+</span> std.sort.lowerBound(</span>
<span class="line">            Value,</span>
<span class="line">            table.values.items[start_index..],</span>
<span class="line">            key,</span>
<span class="line">            compare_fn,</span>
<span class="line">        );</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">fn</span><span class="hl-function"> compare_fn</span>(key: Key, value: Value) std.math.Order {</span>
<span class="line">        <span class="hl-keyword">return</span> key_cmp(key, key_fn(value));</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> get</span>(table: <span class="hl-operator">*</span><span class="hl-keyword">const</span> Table, key: Key) ?Value {</span>
<span class="line">        <span class="hl-keyword">const</span> index = table.search(key, <span class="hl-numbers">0</span>);</span>
<span class="line">        <span class="hl-keyword">if</span> (index &gt;= table.values.items.len) <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">const</span> value = table.values.items[index];</span>
<span class="line">        <span class="hl-keyword">if</span> (key_cmp(key, key_fn(value)) <span class="hl-operator">!=</span> .eq) <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">return</span> value;</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> reserve</span>(</span>
<span class="line">        table: <span class="hl-operator">*</span>Table,</span>
<span class="line">        gpa: std.mem.Allocator,</span>
<span class="line">        extra: <span class="hl-type">usize</span>,</span>
<span class="line">    ) <span class="hl-operator">!</span><span class="hl-type">void</span> {</span>
<span class="line">        <span class="hl-keyword">try</span> table.values.ensureUnusedCapacity(gpa, extra);</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> insert</span>(table: <span class="hl-operator">*</span>Table, value: Value) <span class="hl-type">void</span> {</span>
<span class="line">        assert(table.values.unusedCapacitySlice().len &gt; <span class="hl-numbers">0</span>);</span>
<span class="line">        <span class="hl-keyword">const</span> index = table.search(key_fn(value), <span class="hl-numbers">0</span>);</span>
<span class="line">        table.values.insertAssumeCapacity(index, value);</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> remove</span>(table: <span class="hl-operator">*</span>Table, value: Value) <span class="hl-type">void</span> {</span>
<span class="line">        <span class="hl-keyword">const</span> index = table.search(key_fn(value), <span class="hl-numbers">0</span>);</span>
<span class="line">        <span class="hl-keyword">const</span> removed = table.values.orderedRemove(index);</span>
<span class="line">        assert(std.meta.eql(value, removed));</span>
<span class="line">    }</span>
<span class="line">};</span></code></pre>

</figure>
<p>The <code>search</code> function binary searches for the index corresponding to the given <code>key</code> in the list of
values. For convenience of the call-site we are yet to see, we also pass in the starting index for
the search. It is useful for, e.g., pagination-style API where you use index as a cursor.</p>
<p>The <code>get</code> function then uses <code>search</code> to find the index, and furthermore checks that we have an
exact match.</p>
<p>For the <code>insert</code> function, we <em>do</em> implement the reservation pattern: memory allocation and data
structure modification are split into two functions. Modification proper is infallible, and has a
reservation as a precondition.</p>
<p>As promised, we do a naive linear memcpy for <code>insert</code> / <code>remove</code>, but we pretend that it is actually
logarithmic.</p>
<p>Another unrealistic simplification is that our API is scalar — we insert or remove a single item
at a time. Both Zig and relational model strongly encorage operating on a batch of objects at a
time, <a href="https://matklad.github.io/2023/11/15/push-ifs-up-and-fors-down.html">pushing the <code>for</code>s down</a>:
<code class="display">pub fn insert(table: *Table, values: []const Value) void</code></p>
<p>Even with a naive array list, the batched version runs in O(N + K log K), which is much faster than
O(N K) of the scalar version repeated K times. But we leave batching as an exercise for the reader.</p>
</section>
<section id="The-Indexes">

    <h2>
    <a href="#The-Indexes">The Indexes </a>
    </h2>
<p>Now comes the relational model part of the tutorial. If we have</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> TransfersTable = TableType(Transfer.ID, Transfer, <span class="hl-keyword">struct</span> {</span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_fn</span>(value: Transfer) Transfer.ID {</span>
<span class="line">        <span class="hl-keyword">return</span> value.id;</span>
<span class="line">    }</span>
<span class="line">    <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_cmp</span>(lhs: Transfer.ID, rhs: Transfer.ID) std.math.Order {</span>
<span class="line">        <span class="hl-keyword">return</span> std.math.order(<span class="hl-built_in">@intFromEnum</span>(lhs), <span class="hl-built_in">@intFromEnum</span>(rhs));</span>
<span class="line">    }</span>
<span class="line">});</span></code></pre>

</figure>
<p>we can efficiently filter transfers by their ids. How can we add an ability to filter transfers by,
say, debit account id?</p>
<p>The idea is to add a second sorted list, which stores pairs of
<span class="display"><code>(Account.ID, Transfer.ID)</code></span></p>
<p>With this setup, if you are interested in all transfers from alice, you can binary search for
alice’s account ID in the second list, fetch corresponding transfer ids, and then lookup transfers
in the first list:</p>

<figure class="code-block">


<pre><code><span class="line">Transfers:</span>
<span class="line">id=1 debit_account=alice    credit_account=bob</span>
<span class="line">id=2 debit_account=charley  credit_account=bob</span>
<span class="line">id=3 debit_account=alice    credit_account=charley</span>
<span class="line"></span>
<span class="line">Index:</span>
<span class="line">debit_account=alice   id=1</span>
<span class="line">debit_account=alice   id=3</span>
<span class="line">debit_account=charley id=2</span></code></pre>

</figure>
<p>What makes this work is that we can maintain two lists in sync. When creating a transfer, you insert
it in the Transfers table, but also insert the corresponding pair to the index table. Removal works
similarly.</p>
</section>
<section id="Implementing-the-Index">

    <h2>
    <a href="#Implementing-the-Index">Implementing the Index </a>
    </h2>
<p>Let’s implement an index table. Here, we start using <code>comptime</code> for real. In particular, we will
parametrize our index table by the type (such as <code>Transfer</code>) and the name of the field to build an
index over (such as <code>.debit_account</code>):</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> TransferDebitAccountIndex =</span>
<span class="line">    IndexTableType(Transfer, .debit_account);</span></code></pre>

</figure>
<p>This is the signature:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> IndexTableType</span>(</span>
<span class="line">    <span class="hl-keyword">comptime</span> Value: <span class="hl-type">type</span>,</span>
<span class="line">    <span class="hl-keyword">comptime</span> field: std.meta.FieldEnum(Value),</span>
<span class="line">) <span class="hl-type">type</span> {</span>
<span class="line">    ...</span>
<span class="line">}</span></code></pre>

</figure>
<p>This is a type constructor, which takes a type and returns a type. The
<code class="display">std.meta.FieldEnum(Value)</code>
call returns an enum whose variants are fields of <code>Value</code>. E.g, our <code>Transfer</code> is</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> Transfer = <span class="hl-keyword">struct</span> {</span>
<span class="line">    id: ID,</span>
<span class="line">    amount: <span class="hl-type">u128</span>,</span>
<span class="line">    debit_account: Account.ID,</span>
<span class="line">    credit_account: Account.ID,</span>
<span class="line">};</span></code></pre>

</figure>
<p>so the corresponding <code>FieldEnum</code> would look like this:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> TransferFieldEnum = <span class="hl-keyword">enum</span> {</span>
<span class="line">    id,</span>
<span class="line">    amount,</span>
<span class="line">    debit_account,</span>
<span class="line">    credit_account,</span>
<span class="line">};</span></code></pre>

</figure>
<p>Now, the body:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> IndexTableType</span>(</span>
<span class="line">    <span class="hl-keyword">comptime</span> Value: <span class="hl-type">type</span>,</span>
<span class="line">    <span class="hl-keyword">comptime</span> field: std.meta.FieldEnum(Value),</span>
<span class="line">) <span class="hl-type">type</span> {</span>
<span class="line">    <span class="hl-keyword">const</span> FieldType = <span class="hl-built_in">@FieldType</span>(Value, <span class="hl-built_in">@tagName</span>(field));</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">const</span> Pair = <span class="hl-keyword">struct</span> {</span>
<span class="line">        field: FieldType,</span>
<span class="line">        id: Value.ID,</span>
<span class="line">    };</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">return</span> TableType(Pair, Pair, <span class="hl-keyword">struct</span> {</span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_fn</span>(value: Pair) Pair {</span>
<span class="line">            <span class="hl-keyword">return</span> value;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_cmp</span>(lhs: Pair, rhs: Pair) std.math.Order {</span>
<span class="line">            <span class="hl-keyword">return</span> order_by(Pair, lhs, rhs, <span class="hl-operator">&amp;</span>.{ .field, .id });</span>
<span class="line">        }</span>
<span class="line">    });</span>
<span class="line">}</span></code></pre>

</figure>
<p>Ultimately, we want to delegate to existing <code>TableType</code>, as that already implements the logic for
storing a sorted list of items. The item for us is a field type and value id pair. One note
about the
<span class="display"><code>const FieldType = @FieldType(Value, @tagName(field));</code></span>
incantation used. <code>FieldEnum</code> is the library-level abstraction. Meta programming builtins, like
<code>@FieldType</code> or <code>@field</code>, work with string names of field (at compile time, of course). <code>@tagName</code>
converts from <code>.debit_account</code> to <code>"debit_account"</code>. We don’t <em>have</em> to use <code>FieldEnum</code>, and could
have used strings throughout, but <code>FieldEnum</code> gives us two advantages:</p>
<ul>
<li>
Earlier type errors: calling <code>IndexTableType</code> with a field that doesn’t exist will error out
at the call site, rather than at the definition side.
</li>
<li>
Greppability: in Zig, field access is always spelled as <code>.debit_account</code> syntactically, so it is
advantageous to stick to the same convention during meta programming, to make sure it also gets
into textual searches.
</li>
</ul>
<p>The <code>Key</code> for our table is the entire <code>Pair</code>. That is, we want to sort not only on the field value,
but on ID as well, to make sure that, when we lookup all ids for a particular field value, we get
back a sorted list. That’s why our <code>key_fn</code> is an identity function:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_fn</span>(value: Pair) Pair {</span>
<span class="line">    <span class="hl-keyword">return</span> value;</span>
<span class="line">}</span></code></pre>

</figure>
<p>In <code>key_cmp</code>, we want to compare first by <code>field</code>, and then by <code>id</code>. We can do it manually, but it’s
more fun to do some meta programming here as well:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_cmp</span>(lhs: Pair, rhs: Pair) std.math.Order {</span>
<span class="line">    <span class="hl-keyword">return</span> order_by(Pair, lhs, rhs, <span class="hl-operator">&amp;</span>.{ .field, .id });</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> order_by</span>(</span>
<span class="line">    <span class="hl-keyword">comptime</span> T: <span class="hl-type">type</span>,</span>
<span class="line">    lhs: T,</span>
<span class="line">    rhs: T,</span>
<span class="line">    <span class="hl-keyword">comptime</span> fields: []<span class="hl-keyword">const</span> std.meta.FieldEnum(T),</span>
<span class="line">) std.math.Order {</span>
<span class="line">    ...</span>
<span class="line">}</span></code></pre>

</figure>
<p><code>order_by</code> is our first mixed-mode function. Some arguments are <code>comptime</code>, but some are runtime.
This function should compare a pair of <code>T</code> by sequentially comparing the values of the corresponding
fields, and returning as soon as two unequal fields are found. Here we use an <code>inline for</code>:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> order_by</span>(</span>
<span class="line">    <span class="hl-keyword">comptime</span> T: <span class="hl-type">type</span>,</span>
<span class="line">    lhs: T,</span>
<span class="line">    rhs: T,</span>
<span class="line">    <span class="hl-keyword">comptime</span> fields: []<span class="hl-keyword">const</span> std.meta.FieldEnum(T),</span>
<span class="line">) std.math.Order {</span>
<span class="line">    <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (fields) <span class="hl-operator">|</span>field<span class="hl-operator">|</span> {</span>
<span class="line">        <span class="hl-keyword">const</span> order = order_enums(</span>
<span class="line">            <span class="hl-built_in">@field</span>(lhs, <span class="hl-built_in">@tagName</span>(field)),</span>
<span class="line">            <span class="hl-built_in">@field</span>(rhs, <span class="hl-built_in">@tagName</span>(field)),</span>
<span class="line">        );</span>
<span class="line">        <span class="hl-keyword">if</span> (order <span class="hl-operator">!=</span> .eq) <span class="hl-keyword">return</span> order;</span>
<span class="line">    }</span>
<span class="line">    <span class="hl-keyword">return</span> .eq;</span>
<span class="line">}</span></code></pre>

</figure>
<p>Because the list of fields is known at compile time, the loop is fully unrolled, and the  actual
generated code ends up looking as a sequence of direct comparisons. <code>@field</code> fetches a field from a
value given a <code>comptime</code> field’s name. <code>order_enums</code> is a little helper which allows comparing
either numbers or enums:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> order_enums</span>(lhs: <span class="hl-type">anytype</span>, rhs: <span class="hl-built_in">@TypeOf</span>(lhs)) std.math.Order {</span>
<span class="line">    <span class="hl-keyword">return</span> <span class="hl-keyword">switch</span> (<span class="hl-built_in">@typeInfo</span>(<span class="hl-built_in">@TypeOf</span>(lhs))) {</span>
<span class="line">        .int =&gt; std.math.order(lhs, rhs),</span>
<span class="line">        .@<span class="hl-string">&quot;enum&quot;</span> =&gt; std.math.order(</span>
<span class="line">            <span class="hl-built_in">@intFromEnum</span>(lhs),</span>
<span class="line">            <span class="hl-built_in">@intFromEnum</span>(rhs),</span>
<span class="line">        ),</span>
<span class="line">        <span class="hl-keyword">else</span> =&gt; <span class="hl-keyword">comptime</span> <span class="hl-keyword">unreachable</span>,</span>
<span class="line">    };</span>
<span class="line">}</span></code></pre>

</figure>
<p><code>@typeInfo</code> is a builtin that allows reflecting on the structure of types. In particular, it
classifies types as structs, unions, enums, integers, etc, exactly what we need here. One wrinkle
here is that <code>enum</code> is a keyword, so the <code>enum</code> variant of <code>@typeInfo</code> is spelled as <code>@"enum"</code>. The
<code>@""</code> syntax allows using any string as a Zig identifier, it’s an escape for keywords.</p>
<p>And that’s basically it for indexes! Now we have our main table (object table), and a number of
index tables. The next task is to bundle them together, so that we can enforce consistency between
the tables.</p>
</section>
<section id="The-Bundle">

    <h2>
    <a href="#The-Bundle">The Bundle </a>
    </h2>
<p>The next thing we will be building is the <code>Bundle</code>. It takes a type, a list of fields to build
indexes over, and provides an API for creating and looking up values while maintaining consistency
of indexes:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> BundleType</span>(</span>
<span class="line">    <span class="hl-keyword">comptime</span> Value: <span class="hl-type">type</span>,</span>
<span class="line">    <span class="hl-keyword">comptime</span> indexed_fields: []<span class="hl-keyword">const</span> std.meta.FieldEnum(Value),</span>
<span class="line">) <span class="hl-type">type</span></span></code></pre>

</figure>
<p>With the bundle, we can finally explain what is the database that we’ve started with:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> DB = <span class="hl-keyword">struct</span> {</span>
<span class="line">    account: BundleType(Account, <span class="hl-operator">&amp;</span>.{}),</span>
<span class="line">    transfer: BundleType(Transfer, <span class="hl-operator">&amp;</span>.{</span>
<span class="line">        debit_account,</span>
<span class="line">        credit_account,</span>
<span class="line">    }),</span>
<span class="line">}</span></code></pre>

</figure>
<p>And these were the API we used, and which we’ll now implement:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">var</span> db: DB = ...;</span>
<span class="line"><span class="hl-keyword">try</span> db.account.create(gpa, .{ .balance = <span class="hl-numbers">100</span> });</span>
<span class="line">db.account.update(.{ .id = debit_account, .balance = dr.balance <span class="hl-operator">-</span> amount });</span>
<span class="line">db.account.get(debit_account);</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">try</span> db.transfer.create(gpa, .{</span>
<span class="line">    .debit_account = debit_account,</span>
<span class="line">    .credit_account = credit_account,</span>
<span class="line">    .amount = amount,</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">db.transfer.filter(</span>
<span class="line">    .{ .debit_account = alice, .credit_account = bob },</span>
<span class="line">    <span class="hl-operator">&amp;</span>transfers_buffer,</span>
<span class="line">);</span></code></pre>

</figure>
<p>Let’s start:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> BundleType</span>(</span>
<span class="line">    <span class="hl-keyword">comptime</span> Value: <span class="hl-type">type</span>,</span>
<span class="line">    <span class="hl-keyword">comptime</span> indexed_fields: []<span class="hl-keyword">const</span> std.meta.FieldEnum(Value),</span>
<span class="line">) <span class="hl-type">type</span> {</span>
<span class="line">    <span class="hl-keyword">return</span> <span class="hl-keyword">struct</span> {</span>
<span class="line">        id_counter: <span class="hl-type">u64</span> = <span class="hl-numbers">0</span>,</span>
<span class="line"></span>
<span class="line">        objects: TableType(Value.ID, Value, <span class="hl-keyword">struct</span> {</span>
<span class="line">            <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_fn</span>(value: Value) Value.ID {</span>
<span class="line">                <span class="hl-keyword">return</span> value.id;</span>
<span class="line">            }</span>
<span class="line">            <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_cmp</span>(</span>
<span class="line">                lhs: Value.ID,</span>
<span class="line">                rhs: Value.ID,</span>
<span class="line">            ) std.math.Order {</span>
<span class="line">                <span class="hl-keyword">return</span> std.math.order(</span>
<span class="line">                    <span class="hl-built_in">@intFromEnum</span>(lhs),</span>
<span class="line">                    <span class="hl-built_in">@intFromEnum</span>(rhs),</span>
<span class="line">                );</span>
<span class="line">            }</span>
<span class="line">        }) = .{},</span>
<span class="line"></span>
<span class="line">        indexes: ???,</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">const</span> Bundle = <span class="hl-built_in">@This</span>();</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> get</span>(bundle: <span class="hl-operator">*</span>Bundle, id: Value.ID) ?Value {</span>
<span class="line">            <span class="hl-keyword">return</span> bundle.objects.get(id);</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        ...</span>
<span class="line">    }</span>
<span class="line">}</span></code></pre>

</figure>
<p>The basic structure is clear: we have an <code>id_counter</code> for assigning new ids when creating values,
the object table which stores sorted values and which directly powers the <code>get</code> method, and then we
have the indexes. The indexes are tricky. For transfers, where we index <code>debit_account</code> and
<code>credit_account</code>, we want the <code>indexes</code> to look like this:</p>

<figure class="code-block">


<pre><code><span class="line">indexes: <span class="hl-keyword">struct</span> {</span>
<span class="line">    debit_account:  IndexTableType(Transfer, .debit_account),</span>
<span class="line">    credit_account: IndexTableType(Transfer, .credit_account),</span>
<span class="line">}</span></code></pre>

</figure>
<p>So we need to iterate over passed in <code>indexed_fields</code> and create a struct with a field for each
index. And that’s exactly what we’ll do:</p>

<figure class="code-block">


<pre><code><span class="line">indexes: blk: {</span>
<span class="line">    <span class="hl-keyword">var</span> fields: [indexed_fields.len]std.builtin.Type.StructField =</span>
<span class="line">        <span class="hl-literal">undefined</span>;</span>
<span class="line">    <span class="hl-keyword">for</span> (indexed_fields, <span class="hl-numbers">0</span>..) <span class="hl-operator">|</span>indexed, i<span class="hl-operator">|</span> {</span>
<span class="line">        <span class="hl-keyword">const</span> Type = IndexTableType(Value, indexed);</span>
<span class="line">        fields[i] = .{</span>
<span class="line">            .name = <span class="hl-built_in">@tagName</span>(indexed),</span>
<span class="line">            .<span class="hl-type">type</span> = Type,</span>
<span class="line">            .default_value_ptr = <span class="hl-operator">&amp;</span>(Type{}),</span>
<span class="line">            .is_comptime = <span class="hl-literal">false</span>,</span>
<span class="line">            .alignment = <span class="hl-built_in">@alignOf</span>(Type),</span>
<span class="line">        };</span>
<span class="line">    }</span>
<span class="line">    <span class="hl-keyword">break</span> :blk <span class="hl-built_in">@Type</span>(.{ .@<span class="hl-string">&quot;struct&quot;</span> = .{</span>
<span class="line">        .layout = .auto,</span>
<span class="line">        .is_tuple = <span class="hl-literal">false</span>,</span>
<span class="line">        .decls = <span class="hl-operator">&amp;</span>.{},</span>
<span class="line">        .fields = <span class="hl-operator">&amp;</span>fields,</span>
<span class="line">    } });</span>
<span class="line">} = .{},</span></code></pre>

</figure>
<p>This makes much more sense if you read it backwards:</p>
<ul>
<li>
<code>break :blk</code> “returns” a value from the block labeled <code>blk:</code>, this is Zig’s more imperative take
on “everything is an expression”
</li>
<li>
We return a <code>@Type</code>. <code>@Type</code> is an inverse of <code>@TypeInfo</code>, in a sense that, hand waving a bit,
<span class="display"><code>@Type(@TypeInfo(T)) == T</code>.</span> That is, we pass a description of the type, and get a type
back. What we want to get is a struct with fields, so we pass <code>@"struct"</code> and an array of fields.
</li>
<li>
Each element of <code>fields</code> is an
<span class="display"><code>std.builtin.Type.StructField</code>, </span>
a description of a field, that is, its type, name, and default.
</li>
<li>
The type is
<span class="display"><code>const Type = IndexTableType(Value, indexed);</code></span>
That is, the index table for the <code>indexed</code> field of <code>Value</code>.
</li>
<li>
The name matches the name of the index field.
</li>
<li>
And the default is just a default for the <code>Type</code>.
</li>
<li>
Finally, we need <code>indexed_fields.len</code> fields.
</li>
</ul>
<p>Now that we have all tables, <code>create</code> and <code>update</code> are relatively straightforward. For <code>create</code>, we
need to make sure to insert the appropriate values into the objects table and into all of the
indexes:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> create</span>(</span>
<span class="line">    bundle: <span class="hl-operator">*</span>Bundle,</span>
<span class="line">    gpa: std.mem.Allocator,</span>
<span class="line">    value: Value,</span>
<span class="line">) <span class="hl-operator">!</span>Value.ID {</span>
<span class="line">    assert(<span class="hl-built_in">@intFromEnum</span>(value.id) <span class="hl-operator">==</span> <span class="hl-numbers">0</span>);</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">try</span> bundle.objects.reserve(gpa, <span class="hl-numbers">1</span>);</span>
<span class="line">    <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (indexed_fields) <span class="hl-operator">|</span>field<span class="hl-operator">|</span> {</span>
<span class="line">        <span class="hl-keyword">try</span> <span class="hl-built_in">@field</span>(bundle.indexes, <span class="hl-built_in">@tagName</span>(field))</span>
<span class="line">                .reserve(gpa, <span class="hl-numbers">1</span>);</span>
<span class="line">    }</span>
<span class="line">    <span class="hl-keyword">errdefer</span> <span class="hl-keyword">comptime</span> <span class="hl-keyword">unreachable</span>;</span>
<span class="line"></span>
<span class="line">    bundle.id_counter <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">    <span class="hl-keyword">const</span> id: Value.ID = <span class="hl-built_in">@enumFromInt</span>(bundle.id_counter);</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">var</span> value_with_id = value;</span>
<span class="line">    value_with_id.id = id;</span>
<span class="line"></span>
<span class="line">    bundle.objects.insert(value_with_id);</span>
<span class="line">    <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (indexed_fields) <span class="hl-operator">|</span>indexed_field<span class="hl-operator">|</span> {</span>
<span class="line">        <span class="hl-keyword">const</span> field = <span class="hl-built_in">@tagName</span>(indexed_field);</span>
<span class="line">        <span class="hl-built_in">@field</span>(bundle.indexes, field)</span>
<span class="line">            .insert(.{ .field = <span class="hl-built_in">@field</span>(value, field), .id = id });</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">return</span> id;</span>
<span class="line">}</span></code></pre>

</figure>
<p>We start with asserting that the id is 0. It’s our job to assign the id! But, before we do that, we
reserve space for one more entry in all the tables. This is the place in the function where we
allocate, and where we can fail. The cryptic
<span class="display"><code>errdefer comptime unreachable</code></span>
is a Zig tongue twister to say that no errors can happen after this point in function. Separating
memory reservation and actual modification is helpful to make sure that the data structure remains
consistent even in the face of a memory error.</p>
<p>Had we not split out fallible <code>reserve</code> from infallible <code>insert</code>, and kept the allocation inside
<code>insert</code>, we could have ended in a situation when a value is inserted only in <em>some</em> of the indexes.</p>
<p>I must admit that I am deeply skeptical that it is possible to consistently handle these kind of
issues on memory allocation error correctly, I am in the “abort on OOM” camp personally. As a quick
quiz, have you noticed when we <em>didn’t</em> handle this issue correctly in the code we’ve already seen?</p>
<p>With that throat clearing done, the actual logic is straightforward:</p>
<ul>
<li>
assign id,
</li>
<li>
insert the value into the objects table,
</li>
<li>
and then, for each of the indexed fields, insert the <code>(id, field)</code> pair into the corresponding
index tree. The <code>inline for</code> loop is guaranteed to be fully unrolled at compile time.
</li>
</ul>
<p>As usual, we use <code>@field</code> to get a field by name (c.f. JavaScript <code>obj.foo</code> vs <code>obj[foo]</code>).</p>
<p>The <code>update</code> is even simple, as we don’t need to allocate new memory. So we just remove old values
and insert new ones:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> update</span>(bundle: <span class="hl-operator">*</span>Bundle, value_new: Value) <span class="hl-type">void</span> {</span>
<span class="line">    <span class="hl-keyword">const</span> id = value_new.id;</span>
<span class="line">    assert(<span class="hl-built_in">@intFromEnum</span>(id) <span class="hl-operator">!=</span> <span class="hl-numbers">0</span>);</span>
<span class="line">    <span class="hl-keyword">const</span> value_old = bundle.get(value_new.id).?;</span>
<span class="line">    assert(value_old.id <span class="hl-operator">==</span> id);</span>
<span class="line"></span>
<span class="line">    bundle.objects.remove(value_old);</span>
<span class="line">    bundle.objects.insert(value_new);</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (indexed_fields) <span class="hl-operator">|</span>indexed_field<span class="hl-operator">|</span> {</span>
<span class="line">        <span class="hl-keyword">const</span> field = <span class="hl-built_in">@tagName</span>(indexed_field);</span>
<span class="line">        <span class="hl-built_in">@field</span>(bundle.indexes, field).remove(.{</span>
<span class="line">            .field = <span class="hl-built_in">@field</span>(value_old, field),</span>
<span class="line">            .id = id,</span>
<span class="line">         });</span>
<span class="line">        <span class="hl-built_in">@field</span>(bundle.indexes, field).insert(.{</span>
<span class="line">            .field = <span class="hl-built_in">@field</span>(value_new, field),</span>
<span class="line">            .id = id,</span>
<span class="line">         });</span>
<span class="line">    }</span>
<span class="line">}</span></code></pre>

</figure>
<p>Although simple, this is the trick that makes the whole relational model work. See how we
keep the indexes consistent, by looking up the old value, and removing the corresponding old pairs
from indexes.</p>
<p>If that was to easy, don’t worry, we’ll do <code>filter</code> next, and that’s the toughest one in the entire
exercise :)</p>
</section>
<section id="Merge-Sort-Join">

    <h2>
    <a href="#Merge-Sort-Join">Merge Sort Join </a>
    </h2>
<p>Let’s revisit our original example:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">var</span> transfers_buffer: [<span class="hl-numbers">10</span>]Transfer = <span class="hl-literal">undefined</span>;</span>
<span class="line"><span class="hl-keyword">const</span> alice_to_bob_transfers = db.transfer.filter(</span>
<span class="line">    .{ .debit_account = alice, .credit_account = bob },</span>
<span class="line">    <span class="hl-operator">&amp;</span>transfers_buffer,</span>
<span class="line">);</span>
<span class="line"><span class="hl-keyword">for</span> (alice_to_bob_transfers) <span class="hl-operator">|</span>t<span class="hl-operator">|</span> {</span>
<span class="line">    std.debug.print(<span class="hl-string">&quot;alice to bob: from={} to={} amount={}<span class="hl-string">\n</span>&quot;</span>, .{</span>
<span class="line">        t.debit_account,</span>
<span class="line">        t.credit_account,</span>
<span class="line">        t.amount,</span>
<span class="line">    });</span>
<span class="line">}</span></code></pre>

</figure>
<p>The filter takes a filtering condition, equality conditions on a <em>subset</em> of indexed fields. It then
fills the output buffer with as much objects as possible that match all conditions. How can we do
that effectively?</p>
<p>Recall that our index tables are sorted by the field’s value first, and then by the object’s ID. So, to find
all transfers with
<span class="display"><code>.debit_account = alice</code>,</span>
we binary search the debit account index for pairs starting with <code>alice</code>. Similarly, we can find all
transfers with
<span class="display"><code>.credit_account = bob</code>,</span> by binary searching in the other index table.</p>
<p>In both indexes, we get some slice of pairs whose first components are <code>alice</code> and <code>bob</code>
respectively. Whats more, the <em>second</em> components of the pairs are sorted transfers ids! So, if we
want to find ids which match both conditions, we <em>merge</em> two sorted sequences of ids!</p>
<p>Now let’s do this for an arbitrary number of indexes:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> filter</span>(bundle: <span class="hl-operator">*</span>Bundle, query: <span class="hl-type">anytype</span>, out: []Value) []Value {</span>
<span class="line">}</span></code></pre>

</figure>
<p>We can’t really type the <code>query</code> parameter, so we use Zig’s <code>anytype</code> here. This is <em>not</em> dynamic
typing, rather, it’s monomorphization maximus — every distinct type of <code>query</code> will generate a
fresh copy of the <code>filter</code> function.</p>
<p>First, we reflect on <code>query</code> to figure out how many index tables we need to intersect:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> fields = <span class="hl-keyword">comptime</span> std.meta.fieldNames(<span class="hl-built_in">@TypeOf</span>(query));</span></code></pre>

</figure>
<p>Then, we setup a bunch of indexes (the <code>ijk</code> kind, not the database index kind). We need an index
into the output buffer, and index into the object table, and an index for each index table:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">var</span> out_index: <span class="hl-type">usize</span> = <span class="hl-numbers">0</span>;</span>
<span class="line"><span class="hl-keyword">var</span> object_index: <span class="hl-type">usize</span> = <span class="hl-numbers">0</span>;</span>
<span class="line"><span class="hl-keyword">var</span> indexes: [fields.len]<span class="hl-type">usize</span> = <span class="hl-built_in">@splat</span>(<span class="hl-numbers">0</span>);</span></code></pre>

</figure>
<p>Then, for each index table, we’d want to get a slice of pairs that match the query. Ideally, we’d
want to have <code>fields.len</code> local variables, one variable per each query field, but Zig doesn’t allow
creating local variables via reflection.</p>
<p>What we can have though is a single variable, which is a tuple of slices. To create such a thing, we
first need to create its type:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> TupleOfSlices = <span class="hl-keyword">comptime</span> blk: {</span>
<span class="line">    <span class="hl-keyword">var</span> components: [fields.len]<span class="hl-type">type</span> = <span class="hl-literal">undefined</span>;</span>
<span class="line">    <span class="hl-keyword">for</span> (<span class="hl-numbers">0</span>..fields.len) <span class="hl-operator">|</span>i<span class="hl-operator">|</span> {</span>
<span class="line">        <span class="hl-keyword">const</span> IndexTable = <span class="hl-built_in">@FieldType</span>(</span>
<span class="line">            <span class="hl-built_in">@TypeOf</span>(bundle.indexes),</span>
<span class="line">            fields[i],</span>
<span class="line">        );</span>
<span class="line">        <span class="hl-keyword">const</span> Pair = IndexTable.Value;</span>
<span class="line">        components[i] = []Pair;</span>
<span class="line">    }</span>
<span class="line">    <span class="hl-keyword">break</span> :blk std.meta.Tuple(<span class="hl-operator">&amp;</span>components);</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">var</span> slices: TupleOfSlices = <span class="hl-literal">undefined</span>;</span></code></pre>

</figure>
<p>Then, we can use the <code>search</code> function to find the actual slices:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">var</span> slices: TupleOfSlices = <span class="hl-literal">undefined</span>;</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (fields, <span class="hl-numbers">0</span>..) <span class="hl-operator">|</span>field, i<span class="hl-operator">|</span> {</span>
<span class="line">    <span class="hl-keyword">const</span> index = <span class="hl-built_in">@field</span>(bundle.indexes, field).search(.{</span>
<span class="line">        .field = <span class="hl-built_in">@field</span>(query, field),</span>
<span class="line">        .id = <span class="hl-built_in">@enumFromInt</span>(<span class="hl-numbers">0</span>),</span>
<span class="line">    }, <span class="hl-numbers">0</span>);</span>
<span class="line">    slices[i] = <span class="hl-built_in">@field</span>(bundle.indexes, field)</span>
<span class="line">        .values.items[index..];</span>
<span class="line">}</span></code></pre>

</figure>
<p>Now, the merge algorithm proper. We are pointing a finger at each of the slices we have and, on each
step, advance the fingers that point at the smallest ID. If at some point all our fingers point at the same id, we fetch the corresponding <code>Value</code> and add it to the output.</p>
<p>Ideally, we’d use a k-way merge mere (<code>comptime</code> specialized to a particular k!), but, for
simplicity, we’ll use linear search to find the lowest id. We will be iterating until either we run
out of space in the output buffer, or we run off one of our slices:</p>

<figure class="code-block">


<pre><code><span class="line">outer: <span class="hl-keyword">while</span> (<span class="hl-literal">true</span>) {</span>
<span class="line">    <span class="hl-keyword">if</span> (out_index <span class="hl-operator">==</span> out.len) <span class="hl-keyword">break</span> :outer;</span>
<span class="line">    <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (<span class="hl-numbers">0</span>..fields.len) <span class="hl-operator">|</span>i<span class="hl-operator">|</span> {</span>
<span class="line">        <span class="hl-keyword">if</span> (indexes[i] <span class="hl-operator">==</span> slices[i].len) {</span>
<span class="line">            <span class="hl-keyword">break</span> :outer;</span>
<span class="line">        }</span>
<span class="line">        <span class="hl-keyword">if</span> (slices[i][indexes[i]].field <span class="hl-operator">!=</span> <span class="hl-built_in">@field</span>(query, fields[i])) {</span>
<span class="line">            <span class="hl-keyword">break</span> :outer;</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    ...</span>
<span class="line">}</span></code></pre>

</figure>
<p>Then, we find the minimum ID:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">var</span> id_min = slices[<span class="hl-numbers">0</span>][indexes[<span class="hl-numbers">0</span>]].id;</span>
<span class="line"><span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (<span class="hl-numbers">1</span>..slices.len) <span class="hl-operator">|</span>i<span class="hl-operator">|</span> {</span>
<span class="line">    <span class="hl-keyword">const</span> id_next = slices[i][indexes[i]].id</span>
<span class="line">    <span class="hl-keyword">if</span> (<span class="hl-built_in">@intFromEnum</span>(id_next) &lt; <span class="hl-built_in">@intFromEnum</span>(id_min)) {</span>
<span class="line">        id_min = id_next;</span>
<span class="line">    }</span>
<span class="line">}</span></code></pre>

</figure>
<p>Then, we advance all slices with the minimal ID, counting them:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">var</span> advanced_count: <span class="hl-type">u32</span> = <span class="hl-numbers">0</span>;</span>
<span class="line"><span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (<span class="hl-numbers">0</span>..slices.len) <span class="hl-operator">|</span>i<span class="hl-operator">|</span> {</span>
<span class="line">    <span class="hl-keyword">if</span> (slices[i][indexes[i]].id <span class="hl-operator">==</span> id_min) {</span>
<span class="line">        indexes[i] <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">        advanced_count <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">    }</span>
<span class="line">}</span></code></pre>

</figure>
<p>If we advanced <em>all</em> slices (that is, all ids at a particular position are the same), we lookup the
corresponding transfer in the object table and add it to the output:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">if</span> (advanced_count <span class="hl-operator">==</span> slices.len) {</span>
<span class="line">    object_index = bundle.objects.search(id_min, object_index);</span>
<span class="line">    assert(object_index &lt; bundle.objects.values.items.len);</span>
<span class="line">    <span class="hl-keyword">const</span> value = bundle.objects.values.items[object_index];</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (fields) <span class="hl-operator">|</span>field<span class="hl-operator">|</span> {</span>
<span class="line">        assert(<span class="hl-built_in">@field</span>(value, field) <span class="hl-operator">==</span> <span class="hl-built_in">@field</span>(query, field));</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    out[out_index] = value;</span>
<span class="line">    out_index <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">    object_index <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">}</span></code></pre>

</figure>
<p>This is where we pass a non-zero index to <code>search</code>!</p>
<p>Altogether:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> filter</span>(bundle: <span class="hl-operator">*</span>Bundle, query: <span class="hl-type">anytype</span>, out: []Value) []Value {</span>
<span class="line">    <span class="hl-keyword">const</span> fields = <span class="hl-keyword">comptime</span> std.meta.fieldNames(<span class="hl-built_in">@TypeOf</span>(query));</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">var</span> indexes: [fields.len]<span class="hl-type">usize</span> = <span class="hl-built_in">@splat</span>(<span class="hl-numbers">0</span>);</span>
<span class="line">    <span class="hl-keyword">var</span> out_index: <span class="hl-type">usize</span> = <span class="hl-numbers">0</span>;</span>
<span class="line">    <span class="hl-keyword">var</span> object_index: <span class="hl-type">usize</span> = <span class="hl-numbers">0</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">const</span> TupleOfSlices = <span class="hl-keyword">comptime</span> blk: {</span>
<span class="line">        <span class="hl-keyword">var</span> components: [fields.len]<span class="hl-type">type</span> = <span class="hl-literal">undefined</span>;</span>
<span class="line">        <span class="hl-keyword">for</span> (<span class="hl-numbers">0</span>..fields.len) <span class="hl-operator">|</span>i<span class="hl-operator">|</span> {</span>
<span class="line">            <span class="hl-keyword">const</span> IndexTable = <span class="hl-built_in">@FieldType</span>(</span>
<span class="line">                <span class="hl-built_in">@TypeOf</span>(bundle.indexes),</span>
<span class="line">                fields[i],</span>
<span class="line">            );</span>
<span class="line">            <span class="hl-keyword">const</span> Pair = IndexTable.Value;</span>
<span class="line">            components[i] = []Pair;</span>
<span class="line">        }</span>
<span class="line">        <span class="hl-keyword">break</span> :blk std.meta.Tuple(<span class="hl-operator">&amp;</span>components);</span>
<span class="line">    };</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">var</span> slices: TupleOfSlices = <span class="hl-literal">undefined</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (fields, <span class="hl-numbers">0</span>..) <span class="hl-operator">|</span>field, i<span class="hl-operator">|</span> {</span>
<span class="line">        <span class="hl-keyword">const</span> index = <span class="hl-built_in">@field</span>(bundle.indexes, field).search(.{</span>
<span class="line">            .field = <span class="hl-built_in">@field</span>(query, field),</span>
<span class="line">            .id = <span class="hl-built_in">@enumFromInt</span>(<span class="hl-numbers">0</span>),</span>
<span class="line">        }, <span class="hl-numbers">0</span>);</span>
<span class="line">        slices[i] = <span class="hl-built_in">@field</span>(bundle.indexes, field)</span>
<span class="line">            .values.items[index..];</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    outer: <span class="hl-keyword">while</span> (<span class="hl-literal">true</span>) {</span>
<span class="line">        <span class="hl-keyword">if</span> (out_index <span class="hl-operator">==</span> out.len) <span class="hl-keyword">break</span> :outer;</span>
<span class="line">        <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (<span class="hl-numbers">0</span>..fields.len) <span class="hl-operator">|</span>i<span class="hl-operator">|</span> {</span>
<span class="line">            <span class="hl-keyword">if</span> (indexes[i] <span class="hl-operator">==</span> slices[i].len) {</span>
<span class="line">                <span class="hl-keyword">break</span> :outer;</span>
<span class="line">            }</span>
<span class="line">            <span class="hl-keyword">if</span> (slices[i][indexes[i]].field <span class="hl-operator">!=</span> <span class="hl-built_in">@field</span>(query, fields[i])) {</span>
<span class="line">                <span class="hl-keyword">break</span> :outer;</span>
<span class="line">            }</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">var</span> id_min = slices[<span class="hl-numbers">0</span>][indexes[<span class="hl-numbers">0</span>]].id;</span>
<span class="line">        <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (<span class="hl-numbers">1</span>..slices.len) <span class="hl-operator">|</span>i<span class="hl-operator">|</span> {</span>
<span class="line">            <span class="hl-keyword">const</span> id_next = slices[i][indexes[i]].id;</span>
<span class="line">            <span class="hl-keyword">if</span> (<span class="hl-built_in">@intFromEnum</span>(id_next) &lt; <span class="hl-built_in">@intFromEnum</span>(id_min)) {</span>
<span class="line">                id_min = id_next;</span>
<span class="line">            }</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">var</span> advanced_count: <span class="hl-type">u32</span> = <span class="hl-numbers">0</span>;</span>
<span class="line">        <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (<span class="hl-numbers">0</span>..slices.len) <span class="hl-operator">|</span>i<span class="hl-operator">|</span> {</span>
<span class="line">            <span class="hl-keyword">if</span> (slices[i][indexes[i]].id <span class="hl-operator">==</span> id_min) {</span>
<span class="line">                indexes[i] <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">                advanced_count <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">            }</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">if</span> (advanced_count <span class="hl-operator">==</span> slices.len) {</span>
<span class="line">            object_index = bundle.objects.search(id_min, object_index);</span>
<span class="line">            assert(object_index &lt; bundle.objects.values.items.len);</span>
<span class="line">            <span class="hl-keyword">const</span> value = bundle.objects.values.items[object_index];</span>
<span class="line"></span>
<span class="line">            <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (fields) <span class="hl-operator">|</span>field<span class="hl-operator">|</span> {</span>
<span class="line">                assert(<span class="hl-built_in">@field</span>(value, field) <span class="hl-operator">==</span> <span class="hl-built_in">@field</span>(query, field));</span>
<span class="line">            }</span>
<span class="line"></span>
<span class="line">            out[out_index] = value;</span>
<span class="line">            out_index <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">            object_index <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">return</span> out[<span class="hl-numbers">0</span>..out_index];</span>
<span class="line">}</span></code></pre>

</figure>
<p>Congratulations! We’ve finished <code>BundleType</code>, which means we are past the worst of it, and are
almost at the end!</p>
</section>
<section id="The-Database-Factory">

    <h2>
    <a href="#The-Database-Factory">The Database Factory </a>
    </h2>
<p>We only need code to turn</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> DB = DBType(.{</span>
<span class="line">    .tables = .{</span>
<span class="line">        .account = Account,</span>
<span class="line">        .transfer = Transfer,</span>
<span class="line">    },</span>
<span class="line">    .indexes = .{</span>
<span class="line">        .transfer = .{</span>
<span class="line">            .debit_account, .credit_account,</span>
<span class="line">        },</span>
<span class="line">    },</span>
<span class="line">});</span></code></pre>

</figure>
<p>into a bunch of bundles with indexes, but at this point this should be trivial:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> DBType</span>(<span class="hl-keyword">comptime</span> schema: <span class="hl-type">anytype</span>) <span class="hl-type">type</span> {</span>
<span class="line">    <span class="hl-keyword">const</span> bundle_names =</span>
<span class="line">        std.meta.fieldNames(<span class="hl-built_in">@TypeOf</span>(schema.tables));</span>
<span class="line">    <span class="hl-keyword">var</span> bundles: [bundle_names.len]std.builtin.Type.StructField =</span>
<span class="line">        <span class="hl-literal">undefined</span>;</span>
<span class="line">    <span class="hl-keyword">for</span> (bundle_names, <span class="hl-numbers">0</span>..) <span class="hl-operator">|</span>name, i<span class="hl-operator">|</span> {</span>
<span class="line">        <span class="hl-keyword">const</span> Value = <span class="hl-built_in">@field</span>(schema.tables, name);</span>
<span class="line">        <span class="hl-keyword">const</span> indexes =</span>
<span class="line">            <span class="hl-keyword">if</span> (<span class="hl-built_in">@hasField</span>(<span class="hl-built_in">@TypeOf</span>(schema.indexes), name))</span>
<span class="line">                <span class="hl-built_in">@field</span>(schema.indexes, name)</span>
<span class="line">            <span class="hl-keyword">else</span></span>
<span class="line">                .{};</span>
<span class="line">        <span class="hl-keyword">const</span> Bundle = BundleType(Value, <span class="hl-operator">&amp;</span>indexes);</span>
<span class="line">        bundles[i] = .{</span>
<span class="line">            .name = name,</span>
<span class="line">            .<span class="hl-type">type</span> = Bundle,</span>
<span class="line">            .default_value_ptr = <span class="hl-operator">&amp;</span>Bundle{},</span>
<span class="line">            .is_comptime = <span class="hl-literal">false</span>,</span>
<span class="line">            .alignment = <span class="hl-built_in">@alignOf</span>(Bundle),</span>
<span class="line">        };</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">return</span> <span class="hl-built_in">@Type</span>(.{ .@<span class="hl-string">&quot;struct&quot;</span> = .{</span>
<span class="line">        .layout = .auto,</span>
<span class="line">        .is_tuple = <span class="hl-literal">false</span>,</span>
<span class="line">        .decls = <span class="hl-operator">&amp;</span>.{},</span>
<span class="line">        .fields = <span class="hl-operator">&amp;</span>bundles,</span>
<span class="line">    } });</span>
<span class="line">}</span></code></pre>

</figure>
<p>Here’s the entire thing, <code>db.zig</code>, just under 300 lines:</p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">const</span> std = <span class="hl-built_in">@import</span>(<span class="hl-string">&quot;std&quot;</span>);</span>
<span class="line"><span class="hl-keyword">const</span> assert = std.debug.assert;</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> DBType</span>(<span class="hl-keyword">comptime</span> schema: <span class="hl-type">anytype</span>) <span class="hl-type">type</span> {</span>
<span class="line">    <span class="hl-keyword">const</span> bundle_names =</span>
<span class="line">        std.meta.fieldNames(<span class="hl-built_in">@TypeOf</span>(schema.tables));</span>
<span class="line">    <span class="hl-keyword">var</span> bundles: [bundle_names.len]std.builtin.Type.StructField =</span>
<span class="line">        <span class="hl-literal">undefined</span>;</span>
<span class="line">    <span class="hl-keyword">for</span> (bundle_names, <span class="hl-numbers">0</span>..) <span class="hl-operator">|</span>name, i<span class="hl-operator">|</span> {</span>
<span class="line">        <span class="hl-keyword">const</span> Value = <span class="hl-built_in">@field</span>(schema.tables, name);</span>
<span class="line">        <span class="hl-keyword">const</span> indexes =</span>
<span class="line">            <span class="hl-keyword">if</span> (<span class="hl-built_in">@hasField</span>(<span class="hl-built_in">@TypeOf</span>(schema.indexes), name))</span>
<span class="line">                <span class="hl-built_in">@field</span>(schema.indexes, name)</span>
<span class="line">            <span class="hl-keyword">else</span></span>
<span class="line">                .{};</span>
<span class="line">        <span class="hl-keyword">const</span> Bundle = BundleType(Value, <span class="hl-operator">&amp;</span>indexes);</span>
<span class="line">        bundles[i] = .{</span>
<span class="line">            .name = name,</span>
<span class="line">            .<span class="hl-type">type</span> = Bundle,</span>
<span class="line">            .default_value_ptr = <span class="hl-operator">&amp;</span>Bundle{},</span>
<span class="line">            .is_comptime = <span class="hl-literal">false</span>,</span>
<span class="line">            .alignment = <span class="hl-built_in">@alignOf</span>(Bundle),</span>
<span class="line">        };</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">return</span> <span class="hl-built_in">@Type</span>(.{ .@<span class="hl-string">&quot;struct&quot;</span> = .{</span>
<span class="line">        .layout = .auto,</span>
<span class="line">        .is_tuple = <span class="hl-literal">false</span>,</span>
<span class="line">        .decls = <span class="hl-operator">&amp;</span>.{},</span>
<span class="line">        .fields = <span class="hl-operator">&amp;</span>bundles,</span>
<span class="line">    } });</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> BundleType</span>(</span>
<span class="line">    <span class="hl-keyword">comptime</span> Value: <span class="hl-type">type</span>,</span>
<span class="line">    <span class="hl-keyword">comptime</span> indexed_fields: []<span class="hl-keyword">const</span> std.meta.FieldEnum(Value),</span>
<span class="line">) <span class="hl-type">type</span> {</span>
<span class="line">    <span class="hl-keyword">return</span> <span class="hl-keyword">struct</span> {</span>
<span class="line">        id_counter: <span class="hl-type">u64</span> = <span class="hl-numbers">0</span>,</span>
<span class="line"></span>
<span class="line">        objects: TableType(Value.ID, Value, <span class="hl-keyword">struct</span> {</span>
<span class="line">            <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_fn</span>(value: Value) Value.ID {</span>
<span class="line">                <span class="hl-keyword">return</span> value.id;</span>
<span class="line">            }</span>
<span class="line">            <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_cmp</span>(lhs: Value.ID, rhs: Value.ID) std.math.Order {</span>
<span class="line">                <span class="hl-keyword">return</span> std.math.order(<span class="hl-built_in">@intFromEnum</span>(lhs), <span class="hl-built_in">@intFromEnum</span>(rhs));</span>
<span class="line">            }</span>
<span class="line">        }) = .{},</span>
<span class="line"></span>
<span class="line">        indexes: blk: {</span>
<span class="line">            <span class="hl-keyword">var</span> fields: [indexed_fields.len]std.builtin.Type.StructField = <span class="hl-literal">undefined</span>;</span>
<span class="line">            <span class="hl-keyword">for</span> (indexed_fields, <span class="hl-numbers">0</span>..) <span class="hl-operator">|</span>indexed, i<span class="hl-operator">|</span> {</span>
<span class="line">                <span class="hl-keyword">const</span> Type = IndexTableType(Value, indexed);</span>
<span class="line">                fields[i] = .{</span>
<span class="line">                    .name = <span class="hl-built_in">@tagName</span>(indexed),</span>
<span class="line">                    .<span class="hl-type">type</span> = Type,</span>
<span class="line">                    .default_value_ptr = <span class="hl-operator">&amp;</span>(Type{}),</span>
<span class="line">                    .is_comptime = <span class="hl-literal">false</span>,</span>
<span class="line">                    .alignment = <span class="hl-built_in">@alignOf</span>(Type),</span>
<span class="line">                };</span>
<span class="line">            }</span>
<span class="line">            <span class="hl-keyword">break</span> :blk <span class="hl-built_in">@Type</span>(.{ .@<span class="hl-string">&quot;struct&quot;</span> = .{</span>
<span class="line">                .layout = .auto,</span>
<span class="line">                .is_tuple = <span class="hl-literal">false</span>,</span>
<span class="line">                .decls = <span class="hl-operator">&amp;</span>.{},</span>
<span class="line">                .fields = <span class="hl-operator">&amp;</span>fields,</span>
<span class="line">            } });</span>
<span class="line">        } = .{},</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">const</span> Bundle = <span class="hl-built_in">@This</span>();</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> get</span>(bundle: <span class="hl-operator">*</span>Bundle, id: Value.ID) ?Value {</span>
<span class="line">            <span class="hl-keyword">return</span> bundle.objects.get(id);</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> create</span>(</span>
<span class="line">            bundle: <span class="hl-operator">*</span>Bundle,</span>
<span class="line">            gpa: std.mem.Allocator,</span>
<span class="line">            value: Value,</span>
<span class="line">        ) <span class="hl-operator">!</span>Value.ID {</span>
<span class="line">            assert(<span class="hl-built_in">@intFromEnum</span>(value.id) <span class="hl-operator">==</span> <span class="hl-numbers">0</span>);</span>
<span class="line"></span>
<span class="line">            <span class="hl-keyword">try</span> bundle.objects.reserve(gpa, <span class="hl-numbers">1</span>);</span>
<span class="line">            <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (indexed_fields) <span class="hl-operator">|</span>field<span class="hl-operator">|</span> {</span>
<span class="line">                <span class="hl-keyword">try</span> <span class="hl-built_in">@field</span>(bundle.indexes, <span class="hl-built_in">@tagName</span>(field))</span>
<span class="line">                    .reserve(gpa, <span class="hl-numbers">1</span>);</span>
<span class="line">            }</span>
<span class="line">            <span class="hl-keyword">errdefer</span> <span class="hl-keyword">comptime</span> <span class="hl-keyword">unreachable</span>;</span>
<span class="line"></span>
<span class="line">            bundle.id_counter <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">            <span class="hl-keyword">const</span> id: Value.ID = <span class="hl-built_in">@enumFromInt</span>(bundle.id_counter);</span>
<span class="line"></span>
<span class="line">            <span class="hl-keyword">var</span> value_with_id = value;</span>
<span class="line">            value_with_id.id = id;</span>
<span class="line"></span>
<span class="line">            bundle.objects.insert(value_with_id);</span>
<span class="line">            <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (indexed_fields) <span class="hl-operator">|</span>indexed_field<span class="hl-operator">|</span> {</span>
<span class="line">                <span class="hl-keyword">const</span> field = <span class="hl-built_in">@tagName</span>(indexed_field);</span>
<span class="line">                <span class="hl-built_in">@field</span>(bundle.indexes, field)</span>
<span class="line">                    .insert(.{ .field = <span class="hl-built_in">@field</span>(value, field), .id = id });</span>
<span class="line">            }</span>
<span class="line"></span>
<span class="line">            <span class="hl-keyword">return</span> id;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> update</span>(bundle: <span class="hl-operator">*</span>Bundle, value_new: Value) <span class="hl-type">void</span> {</span>
<span class="line">            <span class="hl-keyword">const</span> id = value_new.id;</span>
<span class="line">            assert(<span class="hl-built_in">@intFromEnum</span>(id) <span class="hl-operator">!=</span> <span class="hl-numbers">0</span>);</span>
<span class="line">            <span class="hl-keyword">const</span> value_old = bundle.get(value_new.id).?;</span>
<span class="line">            assert(value_old.id <span class="hl-operator">==</span> id);</span>
<span class="line"></span>
<span class="line">            bundle.objects.remove(value_old);</span>
<span class="line">            bundle.objects.insert(value_new);</span>
<span class="line"></span>
<span class="line">            <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (indexed_fields) <span class="hl-operator">|</span>indexed_field<span class="hl-operator">|</span> {</span>
<span class="line">                <span class="hl-keyword">const</span> field = <span class="hl-built_in">@tagName</span>(indexed_field);</span>
<span class="line">                <span class="hl-built_in">@field</span>(bundle.indexes, field)</span>
<span class="line">                    .remove(.{ .field = <span class="hl-built_in">@field</span>(value_old, field), .id = id });</span>
<span class="line">                <span class="hl-built_in">@field</span>(bundle.indexes, field)</span>
<span class="line">                    .insert(.{ .field = <span class="hl-built_in">@field</span>(value_new, field), .id = id });</span>
<span class="line">            }</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> filter</span>(bundle: <span class="hl-operator">*</span>Bundle, query: <span class="hl-type">anytype</span>, out: []Value) []Value {</span>
<span class="line">            <span class="hl-keyword">const</span> fields = <span class="hl-keyword">comptime</span> std.meta.fieldNames(<span class="hl-built_in">@TypeOf</span>(query));</span>
<span class="line"></span>
<span class="line">            <span class="hl-keyword">var</span> indexes: [fields.len]<span class="hl-type">usize</span> = <span class="hl-built_in">@splat</span>(<span class="hl-numbers">0</span>);</span>
<span class="line">            <span class="hl-keyword">var</span> out_index: <span class="hl-type">usize</span> = <span class="hl-numbers">0</span>;</span>
<span class="line">            <span class="hl-keyword">var</span> object_index: <span class="hl-type">usize</span> = <span class="hl-numbers">0</span>;</span>
<span class="line"></span>
<span class="line">            <span class="hl-keyword">const</span> TupleOfSlices = <span class="hl-keyword">comptime</span> blk: {</span>
<span class="line">                <span class="hl-keyword">var</span> components: [fields.len]<span class="hl-type">type</span> = <span class="hl-literal">undefined</span>;</span>
<span class="line">                <span class="hl-keyword">for</span> (<span class="hl-numbers">0</span>..fields.len) <span class="hl-operator">|</span>i<span class="hl-operator">|</span> {</span>
<span class="line">                    <span class="hl-keyword">const</span> IndexTable = <span class="hl-built_in">@FieldType</span>(</span>
<span class="line">                        <span class="hl-built_in">@TypeOf</span>(bundle.indexes),</span>
<span class="line">                        fields[i],</span>
<span class="line">                    );</span>
<span class="line">                    <span class="hl-keyword">const</span> Pair = IndexTable.Value;</span>
<span class="line">                    components[i] = []Pair;</span>
<span class="line">                }</span>
<span class="line">                <span class="hl-keyword">break</span> :blk std.meta.Tuple(<span class="hl-operator">&amp;</span>components);</span>
<span class="line">            };</span>
<span class="line"></span>
<span class="line">            <span class="hl-keyword">var</span> slices: TupleOfSlices = <span class="hl-literal">undefined</span>;</span>
<span class="line"></span>
<span class="line">            <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (fields, <span class="hl-numbers">0</span>..) <span class="hl-operator">|</span>field, i<span class="hl-operator">|</span> {</span>
<span class="line">                <span class="hl-keyword">const</span> index = <span class="hl-built_in">@field</span>(bundle.indexes, field).search(.{</span>
<span class="line">                    .field = <span class="hl-built_in">@field</span>(query, field),</span>
<span class="line">                    .id = <span class="hl-built_in">@enumFromInt</span>(<span class="hl-numbers">0</span>),</span>
<span class="line">                }, <span class="hl-numbers">0</span>);</span>
<span class="line">                slices[i] = <span class="hl-built_in">@field</span>(bundle.indexes, field)</span>
<span class="line">                    .values.items[index..];</span>
<span class="line">            }</span>
<span class="line"></span>
<span class="line">            outer: <span class="hl-keyword">while</span> (<span class="hl-literal">true</span>) {</span>
<span class="line">                <span class="hl-keyword">if</span> (out_index <span class="hl-operator">==</span> out.len) <span class="hl-keyword">break</span> :outer;</span>
<span class="line">                <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (<span class="hl-numbers">0</span>..fields.len) <span class="hl-operator">|</span>i<span class="hl-operator">|</span> {</span>
<span class="line">                    <span class="hl-keyword">if</span> (indexes[i] <span class="hl-operator">==</span> slices[i].len) <span class="hl-keyword">break</span> :outer;</span>
<span class="line">                    <span class="hl-keyword">if</span> (slices[i][indexes[i]].field <span class="hl-operator">!=</span> <span class="hl-built_in">@field</span>(query, fields[i])) <span class="hl-keyword">break</span> :outer;</span>
<span class="line">                }</span>
<span class="line"></span>
<span class="line">                <span class="hl-keyword">var</span> id_min = slices[<span class="hl-numbers">0</span>][indexes[<span class="hl-numbers">0</span>]].id;</span>
<span class="line">                <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (<span class="hl-numbers">1</span>..slices.len) <span class="hl-operator">|</span>i<span class="hl-operator">|</span> {</span>
<span class="line">                    <span class="hl-keyword">if</span> (<span class="hl-built_in">@intFromEnum</span>(slices[i][indexes[i]].id) &lt; <span class="hl-built_in">@intFromEnum</span>(id_min)) {</span>
<span class="line">                        id_min = slices[i][indexes[i]].id;</span>
<span class="line">                    }</span>
<span class="line">                }</span>
<span class="line"></span>
<span class="line">                <span class="hl-keyword">var</span> advanced_count: <span class="hl-type">u32</span> = <span class="hl-numbers">0</span>;</span>
<span class="line">                <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (<span class="hl-numbers">0</span>..slices.len) <span class="hl-operator">|</span>i<span class="hl-operator">|</span> {</span>
<span class="line">                    <span class="hl-keyword">if</span> (slices[i][indexes[i]].id <span class="hl-operator">==</span> id_min) {</span>
<span class="line">                        indexes[i] <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">                        advanced_count <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">                    }</span>
<span class="line">                }</span>
<span class="line"></span>
<span class="line">                <span class="hl-keyword">if</span> (advanced_count <span class="hl-operator">==</span> slices.len) {</span>
<span class="line">                    object_index = bundle.objects.search(id_min, object_index);</span>
<span class="line">                    assert(object_index &lt; bundle.objects.values.items.len);</span>
<span class="line">                    <span class="hl-keyword">const</span> value = bundle.objects.values.items[object_index];</span>
<span class="line"></span>
<span class="line">                    <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (fields) <span class="hl-operator">|</span>field<span class="hl-operator">|</span> {</span>
<span class="line">                        assert(<span class="hl-built_in">@field</span>(value, field) <span class="hl-operator">==</span> <span class="hl-built_in">@field</span>(query, field));</span>
<span class="line">                    }</span>
<span class="line"></span>
<span class="line">                    out[out_index] = value;</span>
<span class="line">                    out_index <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">                    object_index <span class="hl-operator">+=</span> <span class="hl-numbers">1</span>;</span>
<span class="line">                }</span>
<span class="line">            }</span>
<span class="line"></span>
<span class="line">            <span class="hl-keyword">return</span> out[<span class="hl-numbers">0</span>..out_index];</span>
<span class="line">        }</span>
<span class="line">    };</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> IndexTableType</span>(<span class="hl-keyword">comptime</span> Value: <span class="hl-type">type</span>, <span class="hl-keyword">comptime</span> field: std.meta.FieldEnum(Value)) <span class="hl-type">type</span> {</span>
<span class="line">    <span class="hl-keyword">const</span> FieldType = <span class="hl-built_in">@FieldType</span>(Value, <span class="hl-built_in">@tagName</span>(field));</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">const</span> Pair = <span class="hl-keyword">struct</span> {</span>
<span class="line">        field: FieldType,</span>
<span class="line">        id: Value.ID,</span>
<span class="line">    };</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">return</span> TableType(Pair, Pair, <span class="hl-keyword">struct</span> {</span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_fn</span>(value: Pair) Pair {</span>
<span class="line">            <span class="hl-keyword">return</span> value;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> key_cmp</span>(lhs: Pair, rhs: Pair) std.math.Order {</span>
<span class="line">            <span class="hl-keyword">return</span> order_by(Pair, lhs, rhs, <span class="hl-operator">&amp;</span>.{ .field, .id });</span>
<span class="line">        }</span>
<span class="line">    });</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> order_by</span>(</span>
<span class="line">    <span class="hl-keyword">comptime</span> T: <span class="hl-type">type</span>,</span>
<span class="line">    lhs: T,</span>
<span class="line">    rhs: T,</span>
<span class="line">    <span class="hl-keyword">comptime</span> fields: []<span class="hl-keyword">const</span> std.meta.FieldEnum(T),</span>
<span class="line">) std.math.Order {</span>
<span class="line">    <span class="hl-keyword">inline</span> <span class="hl-keyword">for</span> (fields) <span class="hl-operator">|</span>field<span class="hl-operator">|</span> {</span>
<span class="line">        <span class="hl-keyword">const</span> order = order_enums(</span>
<span class="line">            <span class="hl-built_in">@field</span>(lhs, <span class="hl-built_in">@tagName</span>(field)),</span>
<span class="line">            <span class="hl-built_in">@field</span>(rhs, <span class="hl-built_in">@tagName</span>(field)),</span>
<span class="line">        );</span>
<span class="line">        <span class="hl-keyword">if</span> (order <span class="hl-operator">!=</span> .eq) <span class="hl-keyword">return</span> order;</span>
<span class="line">    }</span>
<span class="line">    <span class="hl-keyword">return</span> .eq;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> order_enums</span>(lhs: <span class="hl-type">anytype</span>, rhs: <span class="hl-built_in">@TypeOf</span>(lhs)) std.math.Order {</span>
<span class="line">    <span class="hl-keyword">return</span> <span class="hl-keyword">switch</span> (<span class="hl-built_in">@typeInfo</span>(<span class="hl-built_in">@TypeOf</span>(lhs))) {</span>
<span class="line">        .int =&gt; std.math.order(lhs, rhs),</span>
<span class="line">        .@<span class="hl-string">&quot;enum&quot;</span> =&gt; std.math.order(</span>
<span class="line">            <span class="hl-built_in">@intFromEnum</span>(lhs),</span>
<span class="line">            <span class="hl-built_in">@intFromEnum</span>(rhs),</span>
<span class="line">        ),</span>
<span class="line">        <span class="hl-keyword">else</span> =&gt; <span class="hl-keyword">comptime</span> <span class="hl-keyword">unreachable</span>,</span>
<span class="line">    };</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hl-keyword">fn</span><span class="hl-function"> TableType</span>(</span>
<span class="line">    <span class="hl-keyword">comptime</span> KeyType: <span class="hl-type">type</span>,</span>
<span class="line">    <span class="hl-keyword">comptime</span> ValueType: <span class="hl-type">type</span>,</span>
<span class="line">    <span class="hl-keyword">comptime</span> Functions: <span class="hl-type">type</span>,</span>
<span class="line">) <span class="hl-type">type</span> {</span>
<span class="line">    <span class="hl-keyword">const</span> key_fn = Functions.key_fn;</span>
<span class="line">    <span class="hl-keyword">const</span> key_cmp = Functions.key_cmp;</span>
<span class="line"></span>
<span class="line">    <span class="hl-keyword">return</span> <span class="hl-keyword">struct</span> {</span>
<span class="line">        values: std.ArrayListUnmanaged(Value) = .empty,</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">const</span> Key = KeyType;</span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">const</span> Value = ValueType;</span>
<span class="line">        <span class="hl-keyword">const</span> Table = <span class="hl-built_in">@This</span>();</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> get</span>(table: <span class="hl-operator">*</span><span class="hl-keyword">const</span> Table, key: Key) ?Value {</span>
<span class="line">            <span class="hl-keyword">const</span> index = table.search(key, <span class="hl-numbers">0</span>);</span>
<span class="line">            <span class="hl-keyword">if</span> (index &gt;= table.values.items.len) <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line"></span>
<span class="line">            <span class="hl-keyword">const</span> value = table.values.items[index];</span>
<span class="line">            <span class="hl-keyword">if</span> (key_cmp(key, key_fn(value)) <span class="hl-operator">!=</span> .eq) <span class="hl-keyword">return</span> <span class="hl-literal">null</span>;</span>
<span class="line"></span>
<span class="line">            <span class="hl-keyword">return</span> value;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> reserve</span>(table: <span class="hl-operator">*</span>Table, gpa: std.mem.Allocator, extra: <span class="hl-type">usize</span>) <span class="hl-operator">!</span><span class="hl-type">void</span> {</span>
<span class="line">            <span class="hl-keyword">try</span> table.values.ensureUnusedCapacity(gpa, extra);</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> insert</span>(table: <span class="hl-operator">*</span>Table, value: Value) <span class="hl-type">void</span> {</span>
<span class="line">            assert(table.values.unusedCapacitySlice().len &gt; <span class="hl-numbers">0</span>);</span>
<span class="line">            <span class="hl-keyword">const</span> index = table.search(key_fn(value), <span class="hl-numbers">0</span>);</span>
<span class="line">            table.values.insertAssumeCapacity(index, value);</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> remove</span>(table: <span class="hl-operator">*</span>Table, value: Value) <span class="hl-type">void</span> {</span>
<span class="line">            <span class="hl-keyword">const</span> index = table.search(key_fn(value), <span class="hl-numbers">0</span>);</span>
<span class="line">            <span class="hl-keyword">const</span> removed = table.values.orderedRemove(index);</span>
<span class="line">            assert(std.meta.eql(value, removed));</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">pub</span> <span class="hl-keyword">fn</span><span class="hl-function"> search</span>(table: <span class="hl-operator">*</span><span class="hl-keyword">const</span> Table, key: Key, start_index: <span class="hl-type">usize</span>) <span class="hl-type">usize</span> {</span>
<span class="line">            <span class="hl-keyword">return</span> start_index <span class="hl-operator">+</span> std.sort.lowerBound(</span>
<span class="line">                Value,</span>
<span class="line">                table.values.items[start_index..],</span>
<span class="line">                key,</span>
<span class="line">                compare_fn,</span>
<span class="line">            );</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hl-keyword">fn</span><span class="hl-function"> compare_fn</span>(key: Key, value: Value) std.math.Order {</span>
<span class="line">            <span class="hl-keyword">return</span> key_cmp(key, key_fn(value));</span>
<span class="line">        }</span>
<span class="line">    };</span>
<span class="line">}</span></code></pre>

</figure>
</section>
<section id="Post-Script">

    <h2>
    <a href="#Post-Script">Post Script </a>
    </h2>
<p>Note that, while the exercise is useful, it deliberately focuses narrowly on a single aspect of Zig
— comptime reflection. You should avoid this feature if possible: hopefully, I have successfully
convinced you that they can lead to somewhat mind-bending code. The topic of Zig in <em>general</em> is
much larger, and I highly recommend the following resources, in this order:</p>
<ul>
<li>
<a href="https://ziglang.org/documentation/0.14.0/">Zig Reference</a>
</li>
<li>
<a href="https://www.scattered-thoughts.net/writing/assorted-thoughts-on-zig-and-rust/">Assorted thoughts on zig (and rust)</a>
</li>
<li>
<a href="https://matklad.github.io/2023/03/26/zig-and-rust.html">Zig and Rust</a>
</li>
</ul>
</section>"><li><div class="title">Comptime Zig ORM</div><div class="domain"> &bull; March 19, 2025</div></li></a><a class="li" href="https://matklad.github.io/2025/03/19/comptime-zig-orm.html"><li><div class="title">Comptime Zig ORM</div><div class="domain">matklad.github.io &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Nautilus (nautil.us)</h2> (2)</summary><ul><a class="li" href="https://nautil.us/the-extraordinary-imperiled-science-at-the-end-of-the-earth-1198787/"><li><div class="title">The Extraordinary, Imperiled Science at the End of the Earth</div><div class="domain">nautil.us &bull; March 19, 2025</div></li></a><a class="li" href="https://nautil.us/the-deadly-story-of-a-life-giving-element-1198867/"><li><div class="title">The Deadly Story of a Life-Giving Element</div><div class="domain">nautil.us &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Letters of Note (news.lettersofnote.com)</h2> (1)</summary><ul><a class="li" href="https://news.lettersofnote.com/p/most-of-your-life-will-happen-in-fc7"><li><div class="title">Most of your life will happen in the gray spaces between bliss and heartbreak</div><div class="domain">news.lettersofnote.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Hacker News (news.ycombinator.com)</h2> (28)</summary><ul><a class="li" href="https://www.croplife.com/precision-tech/satshot/"><li><div class="title">Satshot Founder Lanny Faleide Takes Global Imagery to New Heights</div><div class="domain">croplife.com &bull; March 19, 2025</div></li></a><a class="li" href="https://arstechnica.com/health/2025/03/florida-man-eats-feral-pig-meat-contracts-rare-biothreat-bacteria/"><li><div class="title">Feral pig meat transmits rare bacteria</div><div class="domain">arstechnica.com &bull; March 19, 2025</div></li></a><a class="li" href="https://fenrisk.com/pagure"><li><div class="title">Supply Chain Attacks on Linux Distributions – Fedora Pagure</div><div class="domain">fenrisk.com &bull; March 19, 2025</div></li></a><a class="li" href="https://phys.org/news/2025-03-blue-ghost-lander-captures-stunning.html"><li><div class="title">Blue Ghost lander captures sunset shots on moon before falling silent</div><div class="domain">phys.org &bull; March 19, 2025</div></li></a><a class="li" href="https://science.nasa.gov/missions/hubble/hubble-captures-vivid-auroras-in-jupiters-atmosphere/"><li><div class="title">Hubble Captures Vivid Auroras in Jupiter's Atmosphere (2016)</div><div class="domain">science.nasa.gov &bull; March 19, 2025</div></li></a><a class="li" href="https://crates.io/crates/crabtime"><li><div class="title">Crabtime: Zig’s Comptime in Rust</div><div class="domain">crates.io &bull; March 19, 2025</div></li></a><a class="li" href="https://www.bbc.co.uk/news/articles/c20dd6yk55yo"><li><div class="title">300-year-old Polish beech voted Tree of the Year</div><div class="domain">bbc.co.uk &bull; March 19, 2025</div></li></a><a class="li" href="https://publicdomainreview.org/collection/michalina-janoszanka/"><li><div class="title">Through a Glass Lushly: Michalina Janoszanka's Reverse Paintings (Ca. 1920s)</div><div class="domain">publicdomainreview.org &bull; March 19, 2025</div></li></a><a class="li" href="https://ciq.com/products/rocky-linux/hardened/"><li><div class="title">Rocky Linux from CIQ – Hardened</div><div class="domain">ciq.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.hollywoodreporter.com/tv/tv-features/blueys-world-success-puppy-juggernaut-1236164905/"><li><div class="title">‘Bluey’s World’: How a Cute Aussie Puppy Became a Juggernaut</div><div class="domain">hollywoodreporter.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.esa.int/Science_Exploration/Human_and_Robotic_Exploration/Pierogi_in_space"><li><div class="title">Pierogi in Space</div><div class="domain">esa.int &bull; March 19, 2025</div></li></a><a class="li" href="https://www.fourmilab.ch/documents/netslum/"><li><div class="title">The Internet Slum: is abandoning the Internet the next big thing? (2004)</div><div class="domain">fourmilab.ch &bull; March 19, 2025</div></li></a><a class="li" href="https://archaeology.org/issues/march-april-2025/letters-from/on-the-origin-of-the-pork-taboo/"><li><div class="title">The Origin of the Pork Taboo</div><div class="domain">archaeology.org &bull; March 19, 2025</div></li></a><a class="li" href="https://markprompt.com/jobs"><li><div class="title">Markprompt (YC W24) – Stripe for customer support – is hiring founding eng in SF</div><div class="domain">markprompt.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.nber.org/papers/w33576"><li><div class="title">Supply constraints do not explain house price, quantity growth across US cities</div><div class="domain">nber.org &bull; March 19, 2025</div></li></a><a class="li" href="https://konvajs.org/"><li><div class="title">Konva.js - Declarative 2D Canvas for React, Vue, and Svelte</div><div class="domain">konvajs.org &bull; March 19, 2025</div></li></a><a class="li" href="https://mssv.net/2025/03/19/the-collective-ambition-behind-odysseus-a-game-changing-sci-fi-larp/"><li><div class="title">The Collective Ambition Behind Odysseus, a Game-Changing Sci-Fi Larp</div><div class="domain">mssv.net &bull; March 19, 2025</div></li></a><a class="li" href="https://platform.openai.com/docs/models/o1-pro"><li><div class="title">OpenAI's o1-pro now available via API</div><div class="domain">platform.openai.com &bull; March 19, 2025</div></li></a><a class="li" href="https://news.ycombinator.com/item?id=43414405"><li><div class="title">Launch HN: Modernbanc (YC W20) – Modern and fast accounting software</div><div class="domain">news.ycombinator.com &bull; March 19, 2025</div></li></a><a class="li" href="https://unsloth.ai/blog/gemma3"><li><div class="title">Fine-tune Google's Gemma 3</div><div class="domain">unsloth.ai &bull; March 19, 2025</div></li></a><a class="li" href="https://deeplearning.cs.cmu.edu/./S25/index.html"><li><div class="title">Introduction to Deep Learning (CMU)</div><div class="domain">deeplearning.cs.cmu.edu &bull; March 19, 2025</div></li></a><a class="li" href="https://chipsandcheese.com/p/looking-ahead-at-intels-xe3-gpu-architecture"><li><div class="title">Looking Ahead at Intel's Xe3 GPU Architecture</div><div class="domain">chipsandcheese.com &bull; March 19, 2025</div></li></a><a class="li" href="https://github.com/sharkdp/fd"><li><div class="title">fd: A simple, fast and user-friendly alternative to 'find'</div><div class="domain">github.com &bull; March 19, 2025</div></li></a><a class="li" href="https://zacharyhuang.substack.com/p/llm-agent-internal-as-a-graph-tutorial"><li><div class="title">LLM Agents Are Simply Graph – Tutorial for Dummies</div><div class="domain">zacharyhuang.substack.com &bull; March 19, 2025</div></li></a><a class="li" href="https://newscenter.lbl.gov/2025/03/19/desi-opens-access-to-the-largest-3d-map-of-the-universe-yet/"><li><div class="title">DESI Opens Access to the Largest 3D Map of the Universe Yet</div><div class="domain">newscenter.lbl.gov &bull; March 19, 2025</div></li></a><a class="li" href="https://joe-antognini.github.io/astronomy/daylight"><li><div class="title">How fast the days are getting longer</div><div class="domain">joe-antognini.github.io &bull; March 19, 2025</div></li></a><a class="li" href="https://szymanowiczs.github.io/bolt3d"><li><div class="title">Bolt3D: Generating 3D Scenes in Seconds</div><div class="domain">szymanowiczs.github.io &bull; March 19, 2025</div></li></a><a class="li" href="https://www.worldsexmap.com/"><li><div class="title">Show HN: I made a worldwide sexual life dashboard</div><div class="domain">worldsexmap.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Psyche | on the human condition (psyche.co)</h2> (1)</summary><ul><a class="li" href="https://psyche.co/guides/how-to-think-about-the-sublime-in-the-natural-world?utm_source=rss-feed"><li><div class="title">How to think about the sublime</div><div class="domain">psyche.co &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">The Pudding (pudding.cool)</h2> (1)</summary><ul><a class="li" href="https://pudding.cool/2025/03/housewives"><li><div class="title">What we can learn from watching reality stars apologize</div><div class="domain">pudding.cool &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Quanta Magazine (quantamagazine.org)</h2> (1)</summary><ul><a class="li" href="https://www.quantamagazine.org/is-dark-energy-getting-weaker-new-evidence-strengthens-the-case-20250319/"><li><div class="title">Is Dark Energy Getting Weaker? New Evidence Strengthens the Case.</div><div class="domain">quantamagazine.org &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Reasons to be Cheerful (reasonstobecheerful.world)</h2> (1)</summary><ul><a class="li" href="https://reasonstobecheerful.world/what-were-reading-genetic-milestone-yellowstone-bison/"><li><div class="title">What We’re Reading: A Genetic Milestone for Yellowstone’s Bison</div><div class="domain">reasonstobecheerful.world &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Seth's Blog (seths.blog)</h2> (1)</summary><ul><a class="li" href="https://seths.blog/2025/03/waves-and-tides/"><li><div class="title">Waves and tides</div><div class="domain">seths.blog &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">The Diplomat (thediplomat.com)</h2> (10)</summary><ul><a class="li" href="https://thediplomat.com/2025/03/the-us-security-treaties-with-japan-and-south-korea-arent-enough-to-keep-the-peace/"><li><div class="title">The US Security Treaties With Japan and South Korea Aren’t Enough to Keep the Peace</div><div class="domain">thediplomat.com &bull; March 19, 2025</div></li></a><a class="li" href="https://thediplomat.com/2025/03/japan-to-pay-first-visit-to-cambodian-naval-base-funded-by-china/"><li><div class="title">Japan to Pay First Visit to Cambodian Naval Base Funded by China</div><div class="domain">thediplomat.com &bull; March 19, 2025</div></li></a><a class="li" href="https://thediplomat.com/2025/03/ethiopian-tech-workers-are-trapped-in-myanmars-scam-centers/"><li><div class="title">Ethiopian Tech Workers Are Trapped in Myanmar’s Scam Centers</div><div class="domain">thediplomat.com &bull; March 19, 2025</div></li></a><a class="li" href="https://thediplomat.com/2025/03/indias-growing-misinformation-crisis-a-threat-to-democracy/"><li><div class="title">India’s Growing Misinformation Crisis: A Threat to Democracy</div><div class="domain">thediplomat.com &bull; March 19, 2025</div></li></a><a class="li" href="https://thediplomat.com/2025/03/whats-behind-the-constitutional-courts-delayed-verdict-on-yoon-suk-yeols-impeachment/"><li><div class="title">What’s Behind the Constitutional Court’s Delayed Verdict on Yoon Suk-yeol’s Impeachment?</div><div class="domain">thediplomat.com &bull; March 19, 2025</div></li></a><a class="li" href="https://thediplomat.com/2025/03/guns-and-manure-sri-lankas-army-and-organic-agriculture/"><li><div class="title">Guns and Manure: Sri Lanka’s Army and Organic Agriculture</div><div class="domain">thediplomat.com &bull; March 19, 2025</div></li></a><a class="li" href="https://thediplomat.com/2025/03/indonesias-foreign-policy-under-prabowo-still-free-but-more-active/"><li><div class="title">Indonesia’s Foreign Policy Under Prabowo: Still Free But More Active?</div><div class="domain">thediplomat.com &bull; March 19, 2025</div></li></a><a class="li" href="https://thediplomat.com/2025/03/greenland-and-great-power-competition/"><li><div class="title">Greenland and Great Power Competition</div><div class="domain">thediplomat.com &bull; March 19, 2025</div></li></a><a class="li" href="https://thediplomat.com/2025/03/why-wont-baloch-civil-rights-groups-condemn-the-bla/"><li><div class="title">Why Won’t Baloch Civil Rights Groups Condemn the BLA?</div><div class="domain">thediplomat.com &bull; March 19, 2025</div></li></a><a class="li" href="https://thediplomat.com/2025/03/concern-in-mongolia-after-police-raid-on-independent-news-outlet/"><li><div class="title">Concern in Mongolia After Police Raid on Independent News Outlet</div><div class="domain">thediplomat.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">YourStory RSS Feed (yourstory.com)</h2> (15)</summary><ul><a class="li" href="https://yourstory.com/2025/03/nvidia-rolls-out-new-ai-superchips-blackwell-ultra-vera-rubin"><li><div class="title">NVIDIA rolls out new AI superchips Blackwell Ultra and Vera Rubin</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/saas-unicorn-icertis-eyes-50-million-in-fresh-funding"><li><div class="title">SaaS unicorn Icertis eyes $50M in fresh funding</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/isro-chairman-narayanan-greets-sunita-williams-india"><li><div class="title">ISRO Chairman Narayanan greets Sunita Williams, says India wishes to utilise her expertise</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/startup-news-updates-daily-roundup-march-19-2025"><li><div class="title">Startup news and updates: Daily roundup (March 19, 2025)</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/blockchain-for-impact-earmarks-usd-200m-healthcare-startups-biomedical-research"><li><div class="title">Blockchain For Impact earmarks $200M for healthcare startups and biomedical research</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/finish-work-fast-efficiently"><li><div class="title">Boost productivity: Cut your workday in half with these hacks</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/10-free-iit-courses-aspiring-entrepreneurs"><li><div class="title">10 Free IIT courses every entrepreneur should take</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/charging-ev-become-fast-filling-gas-tank"><li><div class="title">Charging Your EV has become as Fast as Filling Up Your Gas Tank</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/wealth-tech-startup-dezerv-completes-rs-46-cr-employee-stock-esop-buyback"><li><div class="title">Dezerv completes Rs 46 Cr ESOP buyback</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/shikhar-dhawan-ravi-shastri-ab-de-villiers-abu-dhabi-based-yashaa-global-capital"><li><div class="title">Shikhar Dhawan and AB de Villiers-backed Yashaa Global Capital gets greenlight for $75M fund</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/cabinet-approves-rs-1500-cr-incentive-boost-small-upi-transactions-fy25-26"><li><div class="title">Cabinet approves Rs 1,500 Cr incentive to boost small UPI transactions</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/swiggy-launches-assure-a-b2b-app-for-restaurants-to-source-supplies"><li><div class="title">Swiggy launches Assure, a B2B app for restaurants to source supplies</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/amitabh-kant-chairperson-chancellor-niit-university"><li><div class="title">Amitabh Kant takes over as Chairperson of NIIT University</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/an-ai-tool-to-monitor-newborn-health-mount-everest-youtube-ideos"><li><div class="title">An AI tool to monitor newborn health; Scaling Mt Everest with YouTube videos</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a><a class="li" href="https://yourstory.com/2025/03/building-a-scalable-and-sustainable-age-tech-business"><li><div class="title">Building a scalable and sustainable age-tech business in India</div><div class="domain">yourstory.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Vikkals (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=WHp45BvjQq0"><li><div class="title">When you give more runs 😂😂 #vikkals #shorts</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=dDt2NN-spsM"><li><div class="title">Confidence after taking tough catches 😂😂 #vikkals #shorts</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">VideoFromSpace (youtube.com)</h2> (3)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=v5wGE9UbQn4"><li><div class="title">Sun sets on Firefly's Blue Ghost moon lander in these amazing views</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=JWV1Q4OVELs"><li><div class="title">Euclid dark universe detector delivers 'spectacular new views of the Cosmos'</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=upwGb39wArQ"><li><div class="title">Replay! NASA's SpaceX Crew-9 with Starliner astronauts return to Earth</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Vaak (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=yb2cPKoO1vk"><li><div class="title">Madurai Mani Iyer Iconic Renditions of Muthuswamy Dikshitar Kritis | #Dikshitar250 Tribute</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">V3Cars (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=R_BWB_Yxx3o"><li><div class="title">Creta vs Kushaq: Sub Rs 15 Lakh Battle | Which Car Is More Value for Money?</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">ThePrint (youtube.com)</h2> (15)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=Df866VqsOUk"><li><div class="title">‘We need to focus on mental health,’ says Sudha Murthy in Rajya Sabha</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=CWNBYJe2mMA"><li><div class="title">'India allocates less than 1% of its total health budget to mental health': Jaya Bachchan</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=Ifp70KUDGH0"><li><div class="title">‘India is a peaceful nation & doesn’t aim for war. But it needs to be prepared’: Polish Deputy FM</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=_QrWeHF7e-w"><li><div class="title">‘India is a peaceful nation & doesn’t aim for war. But it needs to be prepared’: Polish Deputy FM</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=0tyv4OfTAi4"><li><div class="title">Nagpur violence & Aurangzeb's divisive legacy #cuttheclutter #nagpurviolence</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=TAoxlaGYfes"><li><div class="title">'World makes business decisions factoring national security': EAM on weaponisation of 'global goods'</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=uQTVjakpUac"><li><div class="title">‘Egg on my face’: Shashi Tharoor acknowledges miscalculating India’s stand on Russia-Ukraine war</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=Ic9K2UpC-f4"><li><div class="title">‘World’s coolest dictator’ & his steel pit- The El Salvador prison where Trump is dumping deportees</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=tvCEVdJx8io"><li><div class="title">Rajasthan's new bill aims to prevent student suicides with stricter regulations for coaching centres</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=sJfyJ8KxFGY"><li><div class="title">Trump dials Putin for Ukraine ceasefire, but Moscow games Washington| #SnapOpinion</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=rNx1JsFizPM"><li><div class="title">LoP Rahul Gandhi meets meets LIC agents, promises to raise issue of costly insurance for poor</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=lPc5PNsnXkw"><li><div class="title">What is autopen, device Trump claims Biden used to sign pardons, and did past presidents use it too?</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=AydPtY4uRmg"><li><div class="title">LIVE: Parliament Budget session | Rajya Sabha | BJP | NDA | Congress | INDIA</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=AeGeg7qtZWI"><li><div class="title">LIVE: Parliament Budget session | Lok Sabha |BJP | NDA | Congress | INDIA</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=hBG3tl7vi4k"><li><div class="title">Ukraine now ‘bilateral’ issue for US, Russia. What Trump-negotiated deal means for Putin, Zelenskyy</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">The Wire (youtube.com)</h2> (8)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=OW-Zd2u4v7Y"><li><div class="title">Waqf Amendment Bill की पूरी सच्चाई: कानून से संपति हड़पने की साजिश</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=zLZbq9xCBos"><li><div class="title">Dhankar Stops John Brittas Mid Speech to Delete Ref to FM, Watch How CPM MP Replied | Rajya Sabha</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=AK_ZOLQ6a10"><li><div class="title">Ashwini Vaishnav's Demonstration on KC Venugopal's Question on Rail Stops Leaves Congress MP Fuming</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=Oq1nNb-x3Og"><li><div class="title">Trump-Putin talks: “The Russians have stolen a clear march over the Americans” - Navtej Sarna</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=5S9mQzDJZ9Q"><li><div class="title">Sonia Gandhi Calls For Higher Wages, More Days for MNREGA</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=ggmr1xz3Gog"><li><div class="title">Propaganda Has Disfigured Our Cinema: Avinash Das (Director, In Galiyon Mein)</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=Z37sGlzlkmM"><li><div class="title">The Wire Wrap: Chhaava Factor in Nagpur Riots & Fadnavis' Responsibility, Holi's Communal Colour</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=7FSg0Vxk6pk"><li><div class="title">Saket Gokhale’s Scathing Criticism of Home Ministry in Front of Amit Shah | Rajya Sabha Speech</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">The School of Life (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=5vMOW-q5FsY"><li><div class="title">The Psychology of Anxious Attachment</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">The Royal Institution (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=AfCVV78kR9s"><li><div class="title">Your AI chat has a shocking water footprint #chatgpt</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">The Graham Norton Show (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=Tq1r4Tt7EZ4"><li><div class="title">Rachel Zegler Can't Believe She's A Movie Star | Extended Interview | The Graham Norton Show</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">The Economist (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=r88qZ_mXhNE"><li><div class="title">Cold call: Putin thwarts Trump</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=t38utPXeAmg"><li><div class="title">What Trump's call with Putin really means</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">The Dodo (youtube.com)</h2> (7)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=bIpqQn5tjlo"><li><div class="title">Tiny Dachshund Becomes Big Sister To Human Babies | The Dodo</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=UdsJv-ouka8"><li><div class="title">Tiny Dachshund Becomes Big Sister To Human Babies | The Dodo</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=59sK4zctTCY"><li><div class="title">When 2 Becomes 3 - Pet Parent Life ❤️ | The Pack</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=KdnXWTC_neo"><li><div class="title">Rescue Pittie Becomes Foster Mom to Nearly 200 Kittens | The Dodo</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=ljQvErpiJI0"><li><div class="title">Rescue Pittie Becomes Foster Mom to Nearly 200 Kittens | The Dodo</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=tH3ev9vSW6g"><li><div class="title">Senior Dog Wanders Into a Home and Stays Forever | The Dodo</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=i4c2JqDzIQA"><li><div class="title">Senior Dog Wanders Into a Home and Stays Forever | The Dodo</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">The Diplomat (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=YiDK6LvwyTg"><li><div class="title">Trump, Tariffs, and America’s Global Messaging</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=t9-mqGKDLLU"><li><div class="title">Duterte in The Hague: The Philippines and the Geopolitics of International Law</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">The Daily Show (youtube.com)</h2> (6)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=BoF906gSGDQ"><li><div class="title">Lewis Black Asks Airlines to Fix Their S**t Amid Recent Catastrophes | The Daily Show</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=Ynovirdj3QY"><li><div class="title">"Republicans need Democratic votes." Um, actually...</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=1r9L1R0c6mU"><li><div class="title">A federal judge blocked the president's deportation order, but Trump just said "nah"</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=0o7762hRZRw"><li><div class="title">Does Trump realize his autopen conspiracy theory makes him look like a frothing lunatic? #DailyShow</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=W8OFrDQkfjM"><li><div class="title">Jon Stewart Knocks Dems' Lack of Vision In Countering The Trump Agenda | The Daily Show</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=i1jukvzrUvk"><li><div class="title">Trump Defies Court Order, Deports Migrants, And Still Finds Time to Trash Biden | The Daily Show</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">TED (youtube.com)</h2> (3)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=U9d0p96N1iw"><li><div class="title">How AI Models Steal Creative Work — and What to Do About It | Ed Newton-Rex | TED</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=uxQ0OoyaALQ"><li><div class="title">How to Stop Being Weird About Money (w/ Paco De Leon) | How to Be a Better Human, a TED Podcast</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=FN6JIyntwR0"><li><div class="title">You’ve probably seen this design before, but do you know its ANCIENT origins? #TEDTalk #History</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">StarTalk (youtube.com)</h2> (3)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=xp9tQNHn1R4"><li><div class="title">96% of the Universe is a mystery!</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=tQ-eTuNY_b4"><li><div class="title">Answering Questions About Infinity, The Multiverse, & Supercolliders</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=10kuoD7xyAU"><li><div class="title">We COULD have had an American Super Duper Collider  😔🦅</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Soft White Underbelly (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=O1ZfxH8wFS0"><li><div class="title">Fentanyl Addict interview-Anna</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=pFX1RQHLK1o"><li><div class="title">What Happens After Spending Decades in Prison-Michael Santos</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Sheena Melwani (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=6hQpgqnGBWI"><li><div class="title">At least we’re going down smiling | #shorts #singing #coversong #interrupted</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Senthil kumar (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=3Vgz6aHB8rg"><li><div class="title">Sultan the Warrior (2025) | AI Teaser | Super Star Rajnikanth | A.R.Rahman</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">SciShow (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=EuMCbxdBjdo"><li><div class="title">The Only Generation That Dreamed in Black and White</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">SciFri (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=DGhSKnvfZ4Q"><li><div class="title">EVERYTHING IS TUBERCULOSIS: Author Livestream and Q&A with John Green - #SciFriBookClub</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Sabine Hossenfelder (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=hmznUuCyVz4"><li><div class="title">"Cosmological Stasis" Could Explain Dark Matter: Does that make sense?</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Qiskit (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=fzyo1O97XMw"><li><div class="title">What is quantum computing? #quantum #quantumcomputing #science</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=jO5L1VYMhGA"><li><div class="title">Quantum Questions Answered: The Basics</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Principles by Ray Dalio (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=BqRgYv2MfwA"><li><div class="title">When does debt become a problem?</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Parithabangal (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=j_wH53Vldrw"><li><div class="title">அப்பா எது சொன்னாலும் நல்லதுக்கா தான் பா இருக்கும்😂 | Parithabangal #shorts</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">newslaundry (youtube.com)</h2> (6)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=v8SVCe4FSN4"><li><div class="title">#NLInterview: भारत का जो बहुत बड़ा तबक़ा है उसकी पूछ नहीं है इस लोकतंत्र में</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=QlpI7Ajy9kc"><li><div class="title">Navika Kumar aur TRP ki ek prem kahaani</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=TG7R1Ybp9s0"><li><div class="title">Nalanda’s period of ‘highest influence’ | NL Interviews Abhay K</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=rbVOrHWmduA"><li><div class="title">The truth of the Cholas: Tolerance vs temple attacks?</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=D7otP_25dCw"><li><div class="title">From ‘service to nation’ to reading for pleasure: Aakriti Mandhwani on ‘middlebrow’ magazines</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=5yykGQLKtiY"><li><div class="title">डंकापति-Aurangzeb संवाद और Twitter पर Grok का क़हर | NL Tippani 228</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">National Geographic (youtube.com)</h2> (3)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=skev9t_fGtU"><li><div class="title">33 seconds with an icon. #NatGeo33</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=Flosu7sKOaM"><li><div class="title">Say bonjour to Senegal! #NoTasteLikeHomewithAntoniPorowski</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=4naEPDnpMPg"><li><div class="title">What are the biggest obstacles that the #NatGeo33 face?</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">MinuteEarth (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=KBzPmuqo4i4"><li><div class="title">Why Is Soap SO Slippery?</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">MadRasana Official (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=8w43d3Cj7Ms"><li><div class="title">Shanmugapriya Featuring Sindhu Rageswari & Kamakshi Ambatipudi | MadRasana Duet</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Loose Talk (youtube.com)</h2> (3)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=Aw002IX4lvQ"><li><div class="title">Hukoomat Se Tang hun 😡 | Moin Akhtar | Anwar Maqsood | Loose Talk</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=Vs3Q6zoYUMc"><li><div class="title">Stand was not Standing 😂 #comedy #loosetalk #moinakhtar</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=zp2preE9oGg"><li><div class="title">Tabinda kon hai? 😂 #comedy #loosetalk #moinakhtar</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Law Chambers of Amish Aggarwala (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=DU0W8je80T4"><li><div class="title">When Victim Anonymity Creates A Legal Dilemma</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=gOC4g0lO_3g"><li><div class="title">Should I bribe the judge?</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Krishnamurti Foundation Trust (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=c4_c0WfBziY"><li><div class="title">The only revolution | Krishnamurti</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Khan Academy (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=Aeddl02frBE"><li><div class="title">Phase changes | Middle school chemistry | Khan Academy</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=6qjq8DQQDCQ"><li><div class="title">Relationships between ideas in informational text | Reading | Khan Academy</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Jist (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=drB5WKiWwTc"><li><div class="title">Explosive Interview on Scandal that Brought Down Rajiv Gandhi | ft. Rahul Shrivastava | Jist</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">ICM Indian Classical Music (youtube.com)</h2> (3)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=o894KBU_9hE"><li><div class="title">Pt Hari Prasad Chaurasia & Rakesh Chaurasia Ji ❣️✨ #flute #icmtabla #classical #music #shorts</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=rv220F-YrXY"><li><div class="title">Bharatnatyam Dance By Pannaga Rao❣️✨ #icmdance #bharatnatyam #classical #dance #icmtabla</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=aiRWscIyHlY"><li><div class="title">Tarana By Aniruddha Aithal ❣️✨ #icmvocal #icmtabla #classical #music #shorts</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Groww (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=jyh9AeORZI8"><li><div class="title">Why are defence stocks rising ?</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=Oa6E8L8Bado"><li><div class="title">Why HDFC Bank is falling so much? | What is the future of HDFC Bank stock?</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">GOTO Conferences (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=McTAqeWJcsk"><li><div class="title">Get the Most Out of GitHub Copilot • Sean Marcia • GOTO 2024</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Global Cycling Network (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=OWTm7DIrq8Q"><li><div class="title">Why I'll Always Commute By Bike</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=lkKd-T05F9M"><li><div class="title">⚠️ Hit The UK SPEED LIMITS? ⚠️ ON A BICYCLE? 🚲</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">freeCodeCamp.org (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=wuVVclLcjuA"><li><div class="title">Learn ANY Language with AI (Learn English, Learn Spanish, Learn Mandarin Chinese, and more)</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Empty Hand (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=R0dbULDIvAg"><li><div class="title">நாம GOOD -ah இருந்தாலும் BAD ஆக்குறாங்க!! Husband Vs Wife💗 Neeya Naana | Vijay Tv | Tamil Troll</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">DiscoveryChannelInd (youtube.com)</h2> (3)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=-P7JcImc6dg"><li><div class="title">The Treasure That Spells Danger! | Mystery at Blind Frog Ranch | Full Episode | Discovery Channel</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=Mqby7EqP7II"><li><div class="title">Romancing the Fragrance of  India- Mysore Sandal : A tale of heritage & innovation</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=rhjfZsW-M48"><li><div class="title">21 Days of Terror Await These Survivalists! | Naked and Afraid | Full Episode | Discovery Channel</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Deep Look (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=QJ8C_xbt0q0"><li><div class="title">They Look Meowvelous | #DeepLook #Shorts</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">DD Movies (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=GrfYwO3B6CQ"><li><div class="title">ரஜினிகாந்த் சிவாஜி கணேசன் அருமையான படம் Tamil Movie | Vadivelu | Goundamani #ddmovies</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Cookd (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=e0y-W5Cf7wE"><li><div class="title">Watch the full show to know CSK ah illa A2P ah! #cpl #cookingchallenge #funcooking #shorts  #cookd</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=X2Wnvt4EOx8"><li><div class="title">Ela Ada, but with a twist—Oats Ada! ✨ A simple, healthy take on the classic, made with blended oats!</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Continuous Delivery (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=_F9BG4M_Gzo"><li><div class="title">Platform Engineering Tools Can HURT More Than HELP</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Cini Mini Movies (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=SzRg-5HsKhc"><li><div class="title">Vijayakanth Accepts Radha - Amman Kovil Kizhakale | R. Sundarrajan | Ravichandran</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=tnoRp0YfiT0"><li><div class="title">Rajasekhar Very Interesting Comedy Scene From Adiyaal Movie | Dr.Rajasekhar Shanti Priya</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">ChessNetwork (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=ypFf-HhPVME"><li><div class="title">CAUTION: This Rapid chess video may put you to sleep #20</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">ChessBase India (youtube.com)</h2> (5)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=BNUtJLkJins"><li><div class="title">Why Did Arjun Erigaisi Point At The Clock Against Fabiano Caruana | World Blitz 2024</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=S1POsJXRkbE"><li><div class="title">Mitrabha Guha on his KBC Hotseat appearance,beating Magnus at Freestyle Friday,winning National Team</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=mVgFdLKixu4"><li><div class="title">One blunder is all it takes - FM Patrik vs Kolbusovsky | Prague International Chess Festival Blitz</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=L-U5GfcR__o"><li><div class="title">Draw!? - Roman Cerulik & GM Liem Quang Le v FM Roman Muzik & GM Pontus Carlsson | Hand & Brain Rapid</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=nXysrmjtQJk"><li><div class="title">Most INSANE Magnus Carlsen Match Ever 🔥😱 #magnuscarlsen #chess #hansniemman</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Chess.com (youtube.com)</h2> (3)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=WODalQVRNgo"><li><div class="title">Should I EN-PASSANT or CHECKMATE?</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=l3hghDmqXDU"><li><div class="title">Chess, But The Horses Are Sleeping</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=nmp_GJorCmI"><li><div class="title">Chess If It Had Boss Fights:</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Chef Ranveer Brar (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=Pw9SL-HIIQQ"><li><div class="title">Sabse easy Mutton Curry, no really 😲 Check it out for yourself 😎🥘 #easymuttonrecipe #ramadanrecipes</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Bob & Brad (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=gLyrFlmk4H4"><li><div class="title">How To Increase Flexion Of The Neck #neckpain #mobility #flexibility</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Big Think (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=tYUB3hruvDE"><li><div class="title">How I found belonging in the most unfamiliar territory | Atsuko Okatsuka</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=Dq371RFmbnU"><li><div class="title">Where did the first life come from?</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Best Documentary (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=jpy4SKeleHs"><li><div class="title">Telegrass | The story behind the dark web biggest dealer</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=Z3vM-qMY5-c"><li><div class="title">Cascade Bigfoot Blood Mystery</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">BBC News (youtube.com)</h2> (14)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=MwtjJKOKOP0"><li><div class="title">Dolphins surround astronauts' space capsule on return to Earth. #Space #BBCNews</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=nP2avID8_sI"><li><div class="title">Nasa astronauts return to Earth after nine months in space | BBC News</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=X3knxS48eK8"><li><div class="title">At least 13 killed as Israel launches fresh Gaza strikes | BBC News</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=3AzFDupm-uk"><li><div class="title">US and European armies should join our war on gangs, Ecuador president tells BBC</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=WvUGhYGMvRA"><li><div class="title">Sir Gareth Southgate says boys need ‘role models’ not gaming and porn | BBC News</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=yM7HKu7dAkg"><li><div class="title">Turkey detains President Erdogan’s main rival days before becoming candidate | BBC News</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=EArm70Wyl_A"><li><div class="title">Wrestler Ashraf Mahrous broke a world record pulling a 279-ton train by his teeth. #Egypt #BBCNews</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=ikXyryJjonA"><li><div class="title">Trump and Putin ‘trust each other', says Kremlin | BBC News</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=o3llLa4S6Is"><li><div class="title">Shoppers were evacuated after an explosion outside a shopping centre in Southampton, UK. #BBCNews</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=1k2uMCJatzU"><li><div class="title">Prosper will serve at least 49 years in prison for killing his mother, brother and sister. #BBCNews</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=mL54P0rrZSE"><li><div class="title">After nine months in space, astronauts Butch Wilmore and Suni Williams are back on Earth. #BBCNews</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=lmoaD1MtAiI"><li><div class="title">Sir Gareth Southgate on the 'crisis' facing young men and what to do about it? | BBC Newscast</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=gHYdrSdtmJI"><li><div class="title">Ukraine accuses Putin of breaking promise to Trump with airstrikes on infrastructure | BBC News</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=xEnaw7-nuBU"><li><div class="title">Tesla vehicles torched at Las Vegas facility. #Tesla #LasVegas #BBCNews</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Aileen and Deven (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=Y880ni4g08I"><li><div class="title">SURPRISING my baby daddy</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=fb9RbGB7t44"><li><div class="title">Rating my boyfriends BODY PARTS</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">agadmator's Chess Channel (youtube.com)</h2> (2)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=xxnAzTgm2i8"><li><div class="title">Only A Genius Makes Chess Look This Simple! || Donner vs Fischer || Second Piatigorsky Cup (1966)</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a><a class="li" href="https://www.youtube.com/watch?v=u8wykZTz2oY"><li><div class="title">"Bane for the Great Dane" || Larsen vs Fischer || Second Piatigorsky Cup (1966)</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">A. R. Rahman (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=n9CTdFia3Oo"><li><div class="title">The Wonderment Tour | ‪USA Tour | 2025 | @ARRahman</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Papa Mummy Kitchen - Specials (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=EUNwrECLbFI"><li><div class="title">भयंकर गर्मियों में, बाजार की icecream नहीं, बस 20min में बनाएं ये किफायती ठंडी-ठंडी मिठाई #summer</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Kurzgesagt – In a Nutshell (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=wo_e0EvEZn8"><li><div class="title">Why Your Brain Blinds You For 2 Hours Every Day</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Cleo Abram (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=rwxRHtfGuUw"><li><div class="title">Why These Astronauts Got Rescued</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details><details open><summary><h2 class="summary">Buildofy (youtube.com)</h2> (1)</summary><ul><a class="li" href="https://www.youtube.com/watch?v=OQNzZUFiIs0"><li><div class="title">This 2500 sq.ft. Courtyard Home Has a Unique Pooja Space! (House Tour)</div><div class="domain">youtube.com &bull; March 19, 2025</div></li></a></ul></details>
  </article>
</body>

</html>